<!doctype html>
<html lang="en">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

  <title>Advanced inter VLAN switching using Cisco - blog.dornea.nu</title>
  <meta content='Advanced inter VLAN switching using Cisco - blog.dornea.nu' property='title' />
  <meta content='Advanced inter VLAN switching using Cisco - blog.dornea.nu' property='og:title' />


<meta property="og:description" content="Continuing my CCNA journey I&rsquo;d like to address inter VLAN switching in a more detailed way. In this post I&rsquo;ll configure my previous topology to use VTP and let STP prevent frame looping and other &ldquo;anomalies&rdquo; on Layer 2.
Updated network topology 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 %%blockdiag # &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.dornea.nu/2015/11/06/advanced-inter-vlan-switching-using-cisco/" />


<meta property="article:published_time" content="2015-11-06T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2015-11-06T00:00:00&#43;00:00"/>








<meta name="generator" content="Hugo 0.120.3">

<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" rel="stylesheet">
<link href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" rel="stylesheet"/>
<style type="text/css">/*https://coolors.co/afd5aa-f0f2ef-a69f98-3d3d3d-8c6057*/
:root {
  --main-color: #8C6056; 
  --secondary-color: #AFD5AA;
  --logo-text-color: #fff;
  --body-text-color: #3d3d3d;
  --heading-text-color: #383838;
  --background-color: #fff;
}</style>
<link href='https://blog.dornea.nu/css/tachyons.min.css' rel="stylesheet">
<link href='https://blog.dornea.nu/css/styles.css' rel="stylesheet">
<link rel="stylesheet" href="https://blog.dornea.nu/css/custom.css">
<link rel="stylesheet" href="https://blog.dornea.nu/css/syntax.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js"></script>


<link rel="icon" 
 
  href='https://blog.dornea.nu/favicon.ico'

type="image/x-icon"/>

<link href='https://blog.dornea.nu/feed.xml' rel="alternate" type="application/atom+xml" title="blog.dornea.nu" />



<script src="https://beamanalytics.b-cdn.net/beam.min.js" data-token="b8a4b728-8eda-42fb-8376-10168c622160" async></script>
</head>
<body class="global-font">
  <nav class=" flex-ns justify-between border-box pa3 pl3-l pr2-l mt1 mt0-ns" id="navbar">
  <div class="flex">
    <a class="f4 fw6 ttu no-underline dim bg-main-color pv1 ph2 br2" id="site-title" href='https://blog.dornea.nu/' title="Home">blog.dornea.nu</a>
  </div>
  
  <div class=" flex-ns mt2 mt0-ns pv1">
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/' title="Home">Home</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='http://dornea.nu' title="About">About</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/feed.xml' title="RSS">RSS</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/tags' title="Tags">Tags</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://brainfck.org' title="Zettelkasten">Zettelkasten</a>
    
  </div>
  
</nav>
  
<main class="center mv4 content-width ph3">
  <div class="f3 fw6 heading-color heading-font post-title">Advanced inter VLAN switching using Cisco</div>
  <p class="silver f6 mt1 mb4 post-meta">
    <time>06 Nov 2015</time> 
     | 
    

    
     ~
  

15 mins
|

    
    tags: [ <a href='https://blog.dornea.nu/tags/networking' class="link silver">networking</a> <a href='https://blog.dornea.nu/tags/cisco' class="link silver">cisco</a> <a href='https://blog.dornea.nu/tags/ccna' class="link silver">ccna</a> <a href='https://blog.dornea.nu/tags/layer-2' class="link silver">layer 2</a> <a href='https://blog.dornea.nu/tags/switch' class="link silver">switch</a> <a href='https://blog.dornea.nu/tags/vlan' class="link silver">vlan</a> <a href='https://blog.dornea.nu/tags/vtp' class="link silver">vtp</a> <a href='https://blog.dornea.nu/tags/stp' class="link silver">stp</a> <a href='https://blog.dornea.nu/tags/ipython' class="link silver">ipython</a> <a href='https://blog.dornea.nu/tags/admin' class="link silver">admin</a>  ]
    

  </p>
  <div class="lh-copy post-content">
    

      <p>Continuing my <a href="http://blog.dornea.nu/tag/ccna/">CCNA</a> journey I&rsquo;d like to address <em>inter VLAN switching</em> in a more detailed way. In this post I&rsquo;ll configure my <a href="http://blog.dornea.nu/2015/10/21/basic-layer-2-switching-using-cisco-packet-tracer/">previous topology</a> to use <strong>VTP</strong> and let <strong>STP</strong> prevent <em>frame looping</em> and other &ldquo;anomalies&rdquo; on <em>Layer 2</em>.</p>
<h2 id="updated-network-topology">Updated network topology</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">blockdiag</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &lt;!-- collapse=True --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">diagram</span> <span class="n">admin</span> <span class="p">{</span><span class="err">â†”</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">PC1</span> <span class="p">[</span><span class="n">shape</span> <span class="o">=</span> <span class="s2">&#34;cisco.pc&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">PC2</span> <span class="p">[</span><span class="n">shape</span> <span class="o">=</span> <span class="s2">&#34;cisco.pc&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">PC3</span> <span class="p">[</span><span class="n">shape</span> <span class="o">=</span> <span class="s2">&#34;cisco.pc&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">PC4</span> <span class="p">[</span><span class="n">shape</span> <span class="o">=</span> <span class="s2">&#34;cisco.pc&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">PC5</span> <span class="p">[</span><span class="n">shape</span> <span class="o">=</span> <span class="s2">&#34;cisco.pc&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">PC6</span> <span class="p">[</span><span class="n">shape</span> <span class="o">=</span> <span class="s2">&#34;cisco.pc&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">SW4</span> <span class="o">&lt;-&gt;</span> <span class="n">SW1</span><span class="p">,</span> <span class="n">SW2</span><span class="p">,</span> <span class="n">SW3</span> <span class="p">[</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&#34;red&#34;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&#34;dotted&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">SW1</span> <span class="o">&lt;-&gt;</span> <span class="n">SW2</span> <span class="p">[</span><span class="n">folded</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">SW2</span> <span class="o">&lt;-&gt;</span> <span class="n">SW3</span> <span class="p">[</span><span class="n">folded</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">group</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;VLAN 10&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">color</span> <span class="o">=</span> <span class="s2">&#34;#FFF&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">SW1</span> <span class="o">&lt;-&gt;</span> <span class="n">PC1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">SW1</span> <span class="o">&lt;-&gt;</span> <span class="n">PC2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">group</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;VLAN 20&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">color</span> <span class="o">=</span> <span class="s2">&#34;#FFF&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">SW2</span> <span class="o">&lt;-&gt;</span> <span class="n">PC3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">SW2</span> <span class="o">&lt;-&gt;</span> <span class="n">PC4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">group</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;VLAN 10 + VLAN 20&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">color</span> <span class="o">=</span> <span class="s2">&#34;#FFF&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">SW3</span> <span class="o">&lt;-&gt;</span> <span class="n">PC5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">SW3</span> <span class="o">&lt;-&gt;</span> <span class="n">PC6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://blog.dornea.nu/posts/img/2015/advanced-inter-vlan-switching-using-cisco/output_2_0.png" alt="png"></p>
<p>The new added component <code>SW4</code> is connected to all other switches (red lines). Since a new switch has been added we&rsquo;ll have to add the existing <strong>VLANs</strong> to the corresponding interfaces as well. But this time I <strong>won&rsquo;t</strong> configure the ports manually. Instead I&rsquo;ll use a Cisco proprietary protocol called <code>VTP</code> to exchange information about VLAN accross all available switches. So called <code>VTP</code> advertisements can be sent over <code>ISL</code> or <code>802.1Q</code> (dot1q). Now let&rsquo;s have a look at the process of adding <code>VTP</code> to the existing infrastructure.</p>
<h2 id="vlan-trunking-protocol">VLAN Trunking Protocol</h2>
<p><code>VTP</code> has 3 operation modes:</p>
<ul>
<li>VTP <strong>server</strong> mode
<ul>
<li><strong>By default</strong> all Cisco switches are in server mode</li>
<li>VLANs are stored on a device in a file called <code>vlan.dat</code></li>
<li>In server mode changes to the file are allowed</li>
<li>These changes/modifications are carried down to the clients as VTP advertisements</li>
</ul>
</li>
<li>VTP <strong>client</strong> mode
<ul>
<li>Will listen to the changes sent by the server and apply the changes</li>
<li>Is <strong>not</strong> allowed to modify the file <code>vlan.dat</code></li>
</ul>
</li>
<li>VTP <strong>transparent</strong> mode
<ul>
<li>Will relay/forward VTP advertisemnts to downstream clients</li>
<li>BUT will <strong>not</strong> apply the changes</li>
<li><strong>IS</strong> allowed to add/delete VLANs</li>
<li><strong>CAN</strong> modify its <code>vlan.dat</code></li>
</ul>
</li>
</ul>
<p>For my purpose I&rsquo;ll chose following setup:</p>
<ul>
<li><code>SW1</code> in VTP <strong>server</strong> mode</li>
<li>all <strong>others</strong> switches in <strong>client</strong> mode</li>
</ul>
<h3 id="configure-sw1">Configure SW1</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW1&gt;enable
</span></span><span class="line"><span class="cl">Password: 
</span></span><span class="line"><span class="cl">SW1#conf t
</span></span><span class="line"><span class="cl">Enter configuration commands, one per line.  End with CNTL/Z.
</span></span><span class="line"><span class="cl">SW1<span class="o">(</span>config<span class="o">)</span><span class="c1">#vtp mode server</span>
</span></span><span class="line"><span class="cl">Device mode already VTP SERVER.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SW1<span class="o">(</span>config<span class="o">)</span><span class="c1">#vtp domain ccna-lab</span>
</span></span><span class="line"><span class="cl">Changing VTP domain name from NULL to ccna-lab
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SW1<span class="o">(</span>config<span class="o">)</span><span class="c1">#vtp password ccna</span>
</span></span><span class="line"><span class="cl">Setting device VLAN database password to ccna
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SW1<span class="o">(</span>config<span class="o">)</span><span class="c1">#vtp version 2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SW1<span class="o">(</span>config<span class="o">)</span><span class="c1">#do show vtp status</span>
</span></span><span class="line"><span class="cl">VTP Version                     : <span class="m">2</span>
</span></span><span class="line"><span class="cl">Configuration Revision          : <span class="m">6</span>
</span></span><span class="line"><span class="cl">Maximum VLANs supported locally : <span class="m">255</span>
</span></span><span class="line"><span class="cl">Number of existing VLANs        : <span class="m">8</span>
</span></span><span class="line"><span class="cl">VTP Operating Mode              : Server
</span></span><span class="line"><span class="cl">VTP Domain Name                 : ccna-lab
</span></span><span class="line"><span class="cl">VTP Pruning Mode                : Disabled
</span></span><span class="line"><span class="cl">VTP V2 Mode                     : Disabled
</span></span><span class="line"><span class="cl">VTP Traps Generation            : Disabled
</span></span><span class="line"><span class="cl">MD5 digest                      : 0x8D 0xCD 0x81 0x32 0xF5 0xBA 0x71 0x33 
</span></span><span class="line"><span class="cl">Configuration last modified by 0.0.0.0 at 3-1-93 01:14:24
</span></span><span class="line"><span class="cl">Local updater ID is 30.30.30.1 on interface Vl30 <span class="o">(</span>lowest numbered VLAN interface found<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configure-vtp-clients">Configure VTP clients</h3>
<p>The configuration of the remaining switches is pretty straight-forward. Let&rsquo;s have a look at an example (in this case <code>SW2</code>):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW2#conf t
</span></span><span class="line"><span class="cl">Enter configuration commands, one per line.  End with CNTL/Z.
</span></span><span class="line"><span class="cl">SW2<span class="o">(</span>config<span class="o">)</span><span class="c1">#vtp domain ccna-lab</span>
</span></span><span class="line"><span class="cl">Domain name already <span class="nb">set</span> to ccna-lab.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SW2<span class="o">(</span>config<span class="o">)</span><span class="c1">#vtp pass ccna</span>
</span></span><span class="line"><span class="cl">Setting device VLAN database password to ccna
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SW2<span class="o">(</span>config<span class="o">)</span><span class="c1">#vtp mode client</span>
</span></span><span class="line"><span class="cl">Setting device to VTP CLIENT mode.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SW2<span class="o">(</span>config<span class="o">)</span><span class="c1">#do show vtp status</span>
</span></span><span class="line"><span class="cl">VTP Version                     : <span class="m">2</span>
</span></span><span class="line"><span class="cl">Configuration Revision          : <span class="m">7</span>
</span></span><span class="line"><span class="cl">Maximum VLANs supported locally : <span class="m">255</span>
</span></span><span class="line"><span class="cl">Number of existing VLANs        : <span class="m">8</span>
</span></span><span class="line"><span class="cl">VTP Operating Mode              : Client
</span></span><span class="line"><span class="cl">VTP Domain Name                 : ccna-lab
</span></span><span class="line"><span class="cl">VTP Pruning Mode                : Disabled
</span></span><span class="line"><span class="cl">VTP V2 Mode                     : Disabled
</span></span><span class="line"><span class="cl">VTP Traps Generation            : Disabled
</span></span><span class="line"><span class="cl">MD5 digest                      : 0xD4 0x40 0x89 0x49 0x1A 0x6E 0x7A 0xBE 
</span></span><span class="line"><span class="cl">Configuration last modified by 30.30.30.1 at 3-1-93 01:04:21
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="testing-setup">Testing setup</h3>
<p>In order to test the configuration I&rsquo;ll add <strong>VLAN 40</strong> (Testing) on <code>SW1</code> and check if that gets advertised:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW1<span class="o">(</span>config<span class="o">)</span><span class="c1">#vlan 40</span>
</span></span><span class="line"><span class="cl">SW1<span class="o">(</span>config-vlan<span class="o">)</span><span class="c1">#name Testing</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Right after we verify if the clients got the VTP advertisements:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW4#sh vlan brief
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">VLAN Name                             Status    Ports
</span></span><span class="line"><span class="cl">...  
</span></span><span class="line"><span class="cl"><span class="m">40</span>   Testing                          active    
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p>If I again delete <strong>VLAN 40</strong> from <code>SW1</code> then the clients should delete it as well:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW1<span class="o">(</span>config<span class="o">)</span><span class="c1">#no vlan 40</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>And now test it:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW2#sh vlan brief
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">VLAN Name                             Status    Ports
</span></span><span class="line"><span class="cl">---- -------------------------------- --------- -------------------------------
</span></span><span class="line"><span class="cl"><span class="m">1</span>    default                          active    Fa0/6, Fa0/7, Fa0/8, Fa0/9
</span></span><span class="line"><span class="cl">                                                Fa0/10, Fa0/11, Fa0/12, Fa0/13
</span></span><span class="line"><span class="cl">                                                Fa0/14, Fa0/15, Fa0/16, Fa0/17
</span></span><span class="line"><span class="cl">                                                Fa0/18, Fa0/19, Fa0/20, Fa0/21
</span></span><span class="line"><span class="cl">                                                Fa0/22, Fa0/23, Fa0/24, Gig0/1
</span></span><span class="line"><span class="cl">                                                Gig0/2
</span></span><span class="line"><span class="cl"><span class="m">10</span>   Students                         active    
</span></span><span class="line"><span class="cl"><span class="m">20</span>   Teachers                         active    Fa0/3, Fa0/4
</span></span><span class="line"><span class="cl"><span class="m">30</span>   Management                       active    
</span></span><span class="line"><span class="cl"><span class="m">1002</span> fddi-default                     active    
</span></span><span class="line"><span class="cl"><span class="m">1003</span> token-ring-default               active    
</span></span><span class="line"><span class="cl"><span class="m">1004</span> fddinet-default                  active    
</span></span><span class="line"><span class="cl"><span class="m">1005</span> trnet-default                    active    
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="spanning-tree-protocol">Spanning Tree Protocol</h2>
<p>Since we now have to deal with <strong>interconnected</strong> switches and <em>frame looping</em> might be an issue, activating <strong>STP</strong> (Spanning Tree Protocol) will help mitigate the impacts of <em>broadcast storms</em> or <em>multiple frame tranmissions</em>. Cisco devices usually use <strong>Per VLAN Spanning Tree Protocol</strong> (PVST+, PVSTP) which is <em>proprietary</em>. The biggest difference to the &ldquo;normal&rdquo; STP (<strong>802.1D</strong>) is that PVST+ creates a different topology <em>per VLAN</em>. That means you can elect different roots (and thus different topology) for every available VLAN. Let&rsquo;s have a look at the desired topology for <code>VLAN 30</code> (Management):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">blockdiag</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &lt;!-- collapse=True --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">diagram</span> <span class="n">admin</span> <span class="p">{</span><span class="err">â†”</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">group</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;VLAN 30 (Management)&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">orientation</span> <span class="o">=</span> <span class="n">portrait</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">color</span> <span class="o">=</span> <span class="s2">&#34;#FFF&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">SW4</span> <span class="o">&lt;-&gt;</span> <span class="n">SW1</span><span class="p">,</span> <span class="n">SW2</span><span class="p">,</span> <span class="n">SW3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">SW1</span> <span class="o">&lt;-&gt;</span> <span class="n">SW2</span> <span class="p">[</span><span class="n">folded</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">SW2</span> <span class="o">&lt;-&gt;</span> <span class="n">SW3</span> <span class="p">[</span><span class="n">folded</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://blog.dornea.nu/posts/img/2015/advanced-inter-vlan-switching-using-cisco/output_8_0.png" alt="png"></p>
<h3 id="roots-election">Root(s) election</h3>
<p>In terms of <strong>STP</strong> <code>SW4</code> will be the <strong>p</strong>rimary (p) and <code>SW2</code> the <strong>s</strong>econdary (s) root. Let&rsquo;s configure <code>Sw4</code> and <code>Sw2</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">! SW4 configuration
</span></span><span class="line"><span class="cl">SW4<span class="o">(</span>config<span class="o">)</span><span class="c1">#spanning-tree vlan 30 root primary</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">! SW2 configuration
</span></span><span class="line"><span class="cl">SW2<span class="o">(</span>config<span class="o">)</span><span class="c1">#spanning-tree vlan 30 root secondary</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>And now let&rsquo;s have a look at the <strong>port connectivity</strong> matrix:</p>
<table cellpadding="0" cellspacing="0" width="100%" border="0">
  <tr>
    <th> </th>
    <th>SW1</th>
    <th>SW2</th>
    <th>SW3</th>
    <th>SW4</th>
  </tr>
  <tr>
    <td>SW1</td>
    <td>-</td>
    <td>Fa0/1 - Fa0/1</td>
    <td>-</td>
    <td>Fa0/4 - Fa0/1</td>
  </tr>
  <tr>
    <td>SW2</td>
    <td>Fa0/1 - Fa0/1</td>
    <td>-</td>
    <td>Fa0/2 - Fa0/1</td>
    <td>Fa0/5 - Fa0/3</td>
  </tr>
  <tr>
    <td>SW3</td>
    <td>-</td>
    <td>Fa0/1 - Fa0/2</td>
    <td> - </td>
    <td>Fa0/4, Fa0/5 - Fa0/2, Fa0/4</td>
  </tr>
  <tr>
    <td>SW4</td>
    <td>Fa0/1 - Fa0/4</td>
    <td>Fa0/3 - Fa0/5</td>
    <td>Fa0/2, Fa0/4 - Fa0/4, Fa0/5</td>
    <td> - </td>
  </tr>
</table>
<p>So <code>SW1</code> (Fa0/1) is connected to <code>SW2</code> (Fa0/1), <code>SW3</code> (Fa0/3) is connected to <code>SW2</code> (Fa0/2) and so on. You may have noticed that <code>SW3</code> and <code>SW4</code> are connected to each other using <strong>4 ports</strong>. In that case we have a <em>redundant</em> connection between both switches. In this case we&rsquo;ll later on configure the redundant connection as an <a href="https://en.wikipedia.org/wiki/EtherChannel"><strong>EtherChannel</strong></a>.</p>
<h3 id="testing-the-stp-configuration">Testing the STP configuration</h3>
<p>And now let&rsquo;s have a look at the STP information:</p>
<ul>
<li><code>SW2</code> (secondary root)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW2#sh spanning-tree vlan <span class="m">30</span>
</span></span><span class="line"><span class="cl">VLAN0030
</span></span><span class="line"><span class="cl">  Spanning tree enabled protocol ieee
</span></span><span class="line"><span class="cl">  Root ID    Priority    <span class="m">20510</span>
</span></span><span class="line"><span class="cl">             Address     00E0.F96C.2E07
</span></span><span class="line"><span class="cl">             Cost        <span class="m">19</span>
</span></span><span class="line"><span class="cl">             Port        5<span class="o">(</span>FastEthernet0/5<span class="o">)</span>
</span></span><span class="line"><span class="cl">             Hello Time  <span class="m">2</span> sec  Max Age <span class="m">20</span> sec  Forward Delay <span class="m">15</span> sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  Bridge ID  Priority    <span class="m">28702</span>  <span class="o">(</span>priority <span class="m">28672</span> sys-id-ext 30<span class="o">)</span>
</span></span><span class="line"><span class="cl">             Address     0030.F222.3EE5
</span></span><span class="line"><span class="cl">             Hello Time  <span class="m">2</span> sec  Max Age <span class="m">20</span> sec  Forward Delay <span class="m">15</span> sec
</span></span><span class="line"><span class="cl">             Aging Time  <span class="m">20</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Interface        Role Sts Cost      Prio.Nbr Type
</span></span><span class="line"><span class="cl">---------------- ---- --- --------- -------- --------------------------------
</span></span><span class="line"><span class="cl">Fa0/1            Desg FWD <span class="m">19</span>        128.1    P2p
</span></span><span class="line"><span class="cl">Fa0/2            Altn BLK <span class="m">19</span>        128.2    P2p
</span></span><span class="line"><span class="cl">Fa0/5            Root FWD <span class="m">19</span>        128.5    P2p
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can notice that:</p>
<ol>
<li>The root has a MAC address of <code>00E0.F96C.2E07</code></li>
<li><code>FastEthernet 0/5</code> is the <strong>root port</strong> with a <strong>cost</strong> of 19 and is in <strong>forwarding</strong> state</li>
<li><code>FastEthernet 0/2</code> is in <strong>blocking</strong> state</li>
<li><code>FastEthernet 0/1</code> is the <strong>designated</strong> port</li>
</ol>
<ul>
<li><code>SW4</code> (primary root)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW4#sh spanning-tree vlan <span class="m">30</span> 
</span></span><span class="line"><span class="cl">VLAN0030
</span></span><span class="line"><span class="cl">  Spanning tree enabled protocol ieee
</span></span><span class="line"><span class="cl">  Root ID    Priority    <span class="m">20510</span>
</span></span><span class="line"><span class="cl">             Address     00E0.F96C.2E07
</span></span><span class="line"><span class="cl">             This bridge is the root
</span></span><span class="line"><span class="cl">             Hello Time  <span class="m">2</span> sec  Max Age <span class="m">20</span> sec  Forward Delay <span class="m">15</span> sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  Bridge ID  Priority    <span class="m">20510</span>  <span class="o">(</span>priority <span class="m">20480</span> sys-id-ext 30<span class="o">)</span>
</span></span><span class="line"><span class="cl">             Address     00E0.F96C.2E07
</span></span><span class="line"><span class="cl">             Hello Time  <span class="m">2</span> sec  Max Age <span class="m">20</span> sec  Forward Delay <span class="m">15</span> sec
</span></span><span class="line"><span class="cl">             Aging Time  <span class="m">20</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Interface        Role Sts Cost      Prio.Nbr Type
</span></span><span class="line"><span class="cl">---------------- ---- --- --------- -------- --------------------------------
</span></span><span class="line"><span class="cl">Fa0/1            Desg FWD <span class="m">19</span>        128.1    P2p
</span></span><span class="line"><span class="cl">Fa0/3            Desg FWD <span class="m">19</span>        128.3    P2p
</span></span><span class="line"><span class="cl">Po1              Desg FWD <span class="m">9</span>         128.27   Shr
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can notice that:</p>
<ol>
<li>This is indeed the root (<strong>&ldquo;This bridge is the root&rdquo;</strong>)</li>
<li>All available ports are <strong>designated</strong> and in <strong>forwarding</strong> state (the root has <strong>no</strong> root port)</li>
</ol>
<ul>
<li><code>SW3</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW3#sh spanning-tree vlan <span class="m">30</span> 
</span></span><span class="line"><span class="cl">VLAN0030
</span></span><span class="line"><span class="cl">  Spanning tree enabled protocol ieee
</span></span><span class="line"><span class="cl">  Root ID    Priority    <span class="m">20510</span>
</span></span><span class="line"><span class="cl">             Address     00E0.F96C.2E07
</span></span><span class="line"><span class="cl">             Cost        <span class="m">9</span>
</span></span><span class="line"><span class="cl">             Port        27<span class="o">(</span>Port-channel 2<span class="o">)</span>
</span></span><span class="line"><span class="cl">             Hello Time  <span class="m">2</span> sec  Max Age <span class="m">20</span> sec  Forward Delay <span class="m">15</span> sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  Bridge ID  Priority    <span class="m">32798</span>  <span class="o">(</span>priority <span class="m">32768</span> sys-id-ext 30<span class="o">)</span>
</span></span><span class="line"><span class="cl">             Address     0003.E481.688D
</span></span><span class="line"><span class="cl">             Hello Time  <span class="m">2</span> sec  Max Age <span class="m">20</span> sec  Forward Delay <span class="m">15</span> sec
</span></span><span class="line"><span class="cl">             Aging Time  <span class="m">20</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Interface        Role Sts Cost      Prio.Nbr Type
</span></span><span class="line"><span class="cl">---------------- ---- --- --------- -------- --------------------------------
</span></span><span class="line"><span class="cl">Fa0/1            Desg FWD <span class="m">19</span>        128.1    P2p
</span></span><span class="line"><span class="cl">Po2              Root FWD <span class="m">9</span>         128.27   Shr
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can notice that:</p>
<ol>
<li><code>Po2</code> is the <strong>root port</strong> with a cost of 9 and in <strong>forwarding</strong> state</li>
<li><code>FastEthernet 0/1</code> is a <strong>designated</strong> port with a cost of 19 and in <strong>forwarding</strong> state</li>
</ol>
<h3 id="port-cost">Port cost</h3>
<p>Now you may have noticed the diffrent <strong>port costs</strong>. A port cost is an integer assigned to each interface per VLAN for providing a good way for measuring a port&rsquo;s connectivity.</p>
<table cellpadding="0" cellspacing="0" width="100%" border="0">
  <tr>
    <th>Ethernet </th>
    <th>Cost</th>
  </tr>
  <tr>
    <td>10 Mbps</td>
    <td>100</td>
  </tr>
  <tr>
    <td>100 Mbps</td>
    <td>19</td>
  </tr>
  <tr>
    <td>1 Gbps</td>
    <td>4</td>
  </tr>
  <tr>
    <td>10 Gbps</td>
    <td>2</td>
  </tr>
</table>
<p>So because most of the ports are <em>FastEthernet</em> ports they will get a port cost of 19 (when connected directly to the root).</p>
<h3 id="etherchannel">EtherChannel</h3>
<p>As previosuly mentioned there are 2 port links between <code>SW3</code> and <code>SW4</code>. <strong>EtherChannel</strong> provides a way to prevent convergence (STP) when a single port or cable failure occurs. The switches will treat the EtherChannel as a single interface. The big advantage is that if one of the links fails, STP convergence does not have to occur if at least one of the links is up. Besides that the switches will now have a <strong>load-balancing</strong> effect which will spread the traffic load accross the active links in the (Ether)channel.</p>
<h4 id="manual-etherchannel">Manual EtherChannel</h4>
<p>So when using EtherChannels STP will operate on the EtherChannel itself rather than on the individual physical links. STP will then either forward or block traffic on the entire logical EtherChannel for a specific VLAN. Probably the most simple way to activate EtherChannel is to put the physical interfaces into the same <strong>channel-group</strong>. Let&rsquo;s have a look how this is done:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW3<span class="o">(</span>config<span class="o">)</span><span class="c1">#int f0/4</span>
</span></span><span class="line"><span class="cl">SW3<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#channel-group 1 mode on</span>
</span></span><span class="line"><span class="cl">SW3<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#</span>
</span></span><span class="line"><span class="cl">%LINK-5-CHANGED: Interface Port-channel 1, changed state to up
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">%LINEPROTO-5-UPDOWN: Line protocol on Interface Port-channel 1, changed state to up
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SW3<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#int f0/5</span>
</span></span><span class="line"><span class="cl">SW3<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#channel-group 1 mode on</span>
</span></span><span class="line"><span class="cl">SW3<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#</span>
</span></span><span class="line"><span class="cl">%LINK-5-CHANGED: Interface Port-channel 2, changed state to down
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">%LINEPROTO-5-UPDOWN: Line protocol on Interface Port-channel 2, changed state to down
</span></span></code></pre></td></tr></table>
</div>
</div><p>And now for <code>SW4</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW4<span class="o">(</span>config<span class="o">)</span><span class="c1">#int f0/2</span>
</span></span><span class="line"><span class="cl">SW4<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#channel-group 2 mode on</span>
</span></span><span class="line"><span class="cl">SW4<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#</span>
</span></span><span class="line"><span class="cl">%LINK-5-CHANGED: Interface Port-channel 2, changed state to up
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">%LINEPROTO-5-UPDOWN: Line protocol on Interface Port-channel 2, changed state to up
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SW4<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#int f0/4</span>
</span></span><span class="line"><span class="cl">SW4<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#channel-group 2 mode on</span>
</span></span><span class="line"><span class="cl">SW4<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#</span>
</span></span><span class="line"><span class="cl">%LINK-5-CHANGED: Interface Port-channel 1, changed state to down
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">%LINEPROTO-5-UPDOWN: Line protocol on Interface Port-channel 1, changed state to down
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="dynamically-configured-etherchannel">Dynamically configured EtherChannel</h4>
<p>If you don&rsquo;t want to manually configure the EtherChannel, one can let the switches <em>negotiate</em> the configuration for it. Cisco switches support</p>
<ul>
<li>Cisco proprietary Port Aggregation Protocol (<strong>PAgP</strong>)
<ul>
<li>Enabled by the keywords <strong>desirable</strong> and <strong>auto</strong></li>
</ul>
</li>
<li>IEEE standard Link Aggregation Control Protocol (<strong>LACP</strong>)
<ul>
<li>Enabled by the keywords <strong>passive</strong> and <strong>active</strong></li>
</ul>
</li>
</ul>
<p>So when using <strong>PAgP</strong> at least one side must use <strong>desirable</strong> or <strong>active</strong> when using <strong>LACP</strong>. Let&rsquo;s have some look at one example (PAgP):</p>
<ul>
<li><code>SW3</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW3<span class="o">(</span>config<span class="o">)</span><span class="c1">#int f0/4</span>
</span></span><span class="line"><span class="cl">SW3<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#channel-group 2 mode desirable</span>
</span></span><span class="line"><span class="cl">SW3<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#int f0/5</span>
</span></span><span class="line"><span class="cl">SW3<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#channel-group 2 mode desirable</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>SW4</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW4<span class="o">(</span>config<span class="o">)</span><span class="c1">#int f0/2</span>
</span></span><span class="line"><span class="cl">SW4<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#channel-group 1 mode auto</span>
</span></span><span class="line"><span class="cl">SW4<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#int f0/5</span>
</span></span><span class="line"><span class="cl">SW4<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#channel-group 1 mode auto</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="testing-etherchannel-connectivity">Testing EtherChannel connectivity</h3>
<p>Now let&rsquo;s see of the <em>port channels</em> are working well:</p>
<ul>
<li><code>SW4</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW4#sh eth sum
</span></span><span class="line"><span class="cl">Flags:  D - down        P - in port-channel
</span></span><span class="line"><span class="cl">        I - stand-alone s - suspended
</span></span><span class="line"><span class="cl">        H - Hot-standby <span class="o">(</span>LACP only<span class="o">)</span>
</span></span><span class="line"><span class="cl">        R - Layer3      S - Layer2
</span></span><span class="line"><span class="cl">        U - in use      f - failed to allocate aggregator
</span></span><span class="line"><span class="cl">        u - unsuitable <span class="k">for</span> bundling
</span></span><span class="line"><span class="cl">        w - waiting to be aggregated
</span></span><span class="line"><span class="cl">        d - default port
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Number of channel-groups in use: <span class="m">2</span>
</span></span><span class="line"><span class="cl">Number of aggregators:           <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Group  Port-channel  Protocol    Ports
</span></span><span class="line"><span class="cl">------<span class="p">|</span>-------------<span class="p">|</span>-----------<span class="p">|</span>----------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">1</span>      Po1<span class="o">(</span>SU<span class="o">)</span>           -      Fa0/4<span class="o">(</span>P<span class="o">)</span> Fa0/2<span class="o">(</span>P<span class="o">)</span> 
</span></span><span class="line"><span class="cl"><span class="m">2</span>      Po2<span class="o">(</span>SD<span class="o">)</span>           -      
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see there is a port-channel <code>Po1</code> consisting of <code>Fa0/2</code> and <code>Fa0/4</code>. The port.channel is also working and in use.</p>
<ul>
<li><code>SW3</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW3#sh eth sum
</span></span><span class="line"><span class="cl">Flags:  D - down        P - in port-channel
</span></span><span class="line"><span class="cl">        I - stand-alone s - suspended
</span></span><span class="line"><span class="cl">        H - Hot-standby <span class="o">(</span>LACP only<span class="o">)</span>
</span></span><span class="line"><span class="cl">        R - Layer3      S - Layer2
</span></span><span class="line"><span class="cl">        U - in use      f - failed to allocate aggregator
</span></span><span class="line"><span class="cl">        u - unsuitable <span class="k">for</span> bundling
</span></span><span class="line"><span class="cl">        w - waiting to be aggregated
</span></span><span class="line"><span class="cl">        d - default port
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Number of channel-groups in use: <span class="m">2</span>
</span></span><span class="line"><span class="cl">Number of aggregators:           <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Group  Port-channel  Protocol    Ports
</span></span><span class="line"><span class="cl">------<span class="p">|</span>-------------<span class="p">|</span>-----------<span class="p">|</span>----------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">1</span>      Po1<span class="o">(</span>SD<span class="o">)</span>           -      
</span></span><span class="line"><span class="cl"><span class="m">2</span>      Po2<span class="o">(</span>SU<span class="o">)</span>           -      Fa0/4<span class="o">(</span>P<span class="o">)</span> Fa0/5<span class="o">(</span>P<span class="o">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Again <code>Po2</code> is a working port-channel and consists of <code>Fa0/4</code> and <code>Fa0/5</code>.
You also should have noticed that the ports on each switch belong to different channel groups. You can now treat <code>Po1</code> and <code>Po2</code> as interfaces, bring them up or down. If your port-channel is down, do following:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW4<span class="o">(</span>config<span class="o">)</span><span class="c1">#int Po1</span>
</span></span><span class="line"><span class="cl">SW4<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#no shutdown </span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can also add <strong>VLANs</strong> to it:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW4<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#switchport mode trunk</span>
</span></span><span class="line"><span class="cl">SW4<span class="o">(</span>config-if<span class="o">)</span><span class="c1">#switchport trunk allowed vlan 10,20,30</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Afterwards you should be able to verify that:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW4#sh int trunk
</span></span><span class="line"><span class="cl">Port        Mode         Encapsulation  Status        Native vlan
</span></span><span class="line"><span class="cl">Fa0/1       on           802.1q         trunking      <span class="m">1</span>
</span></span><span class="line"><span class="cl">Fa0/3       on           802.1q         trunking      <span class="m">1</span>
</span></span><span class="line"><span class="cl">Po1         on           802.1q         trunking      <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Port        Vlans allowed on trunk
</span></span><span class="line"><span class="cl">Fa0/1       10,20,30
</span></span><span class="line"><span class="cl">Fa0/3       10,20,30
</span></span><span class="line"><span class="cl">Po1         10,20,30
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Port        Vlans allowed and active in management domain
</span></span><span class="line"><span class="cl">Fa0/1       10,20,30
</span></span><span class="line"><span class="cl">Fa0/3       10,20,30
</span></span><span class="line"><span class="cl">Po1         10,20,30
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Port        Vlans in spanning tree forwarding state and not pruned
</span></span><span class="line"><span class="cl">Fa0/1       10,20,30
</span></span><span class="line"><span class="cl">Fa0/3       10,20,30
</span></span><span class="line"><span class="cl">Po1         10,20,30
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="troubleshooting">Troubleshooting</h2>
<p>Although this is not a complex topology, adding STP to your switches, might increase the troubleshooting steps needed to localize your problem. In my particular case I was able to ping from <code>PC3</code> to <code>PC6</code>, however <code>PC1</code> wasn&rsquo;t able to reach <code>PC5</code>. After eliminating a list of might-be problems like:</p>
<ul>
<li>port security</li>
<li>misconfigured trunk ports</li>
<li>wrong VLANs</li>
<li>missing IP addresses</li>
</ul>
<p>I was able to nail down the problem using STP related information. Furthermore it turned out that the <strong>EtherChannel</strong> was not working at all, causing certain frames to be dropped without reaching their final destination. So how might one <em>guess</em> how data would be routed based on output from the <code>show</code> commands?</p>
<p>Let&rsquo;s suppose <code>PC1</code> (10.10.10.101) cannot reach <code>PC5</code> (10.10.10.105). Also keep in mind that both hosts belong to the same <strong>VLAN</strong> (10 = Students). Our simplified topology would look like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">dot</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &lt;!-- collapse=True --&gt;â†”</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">SW1</span> <span class="o">--</span> <span class="n">SW2</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;Fa0/1 - Fa0/1&#34;</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="n">normal</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW2</span> <span class="o">--</span> <span class="n">SW3</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;Fa0/2 - Fa0/1&#34;</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="n">normal</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">SW4</span> <span class="o">--</span> <span class="n">SW1</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;Fa0/4 - Fa0/1&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW4</span> <span class="o">--</span> <span class="n">SW2</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;Fa0/3 - Fa0/5&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW4</span> <span class="o">--</span> <span class="n">SW3</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;Po1 - Po2&#34;</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="n">normal</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">     <span class="n">PC1</span> <span class="p">[</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;PC1 [.101]&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">PC4</span> <span class="p">[</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;PC5 [.105]&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">     <span class="n">SW1</span> <span class="o">--</span> <span class="n">PC1</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;Fa0/2 - Fa0&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW3</span> <span class="o">--</span> <span class="n">PC4</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;Fa0/3 - Fa0&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="p">{</span><span class="n">rank</span> <span class="o">=</span> <span class="n">same</span><span class="p">;</span> <span class="n">SW1</span><span class="p">;</span> <span class="n">SW2</span><span class="p">;</span> <span class="n">SW3</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">     <span class="p">{</span><span class="n">rank</span> <span class="o">=</span> <span class="n">same</span><span class="p">;</span> <span class="n">PC1</span><span class="p">;</span> <span class="n">PC4</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="output_13_0.svg" alt="svg"></p>
<p>There are several way how frames from <code>PC1</code> would reach <code>PC5</code>. However when dealing with <strong>STP</strong> some ports will in be <strong>blocking</strong> state. Let&rsquo;s check that out:</p>
<ul>
<li><code>SW1</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW1#sh spanning-tree vlan <span class="m">10</span>
</span></span><span class="line"><span class="cl">VLAN0010
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Interface        Role Sts Cost      Prio.Nbr Type
</span></span><span class="line"><span class="cl">---------------- ---- --- --------- -------- --------------------------------
</span></span><span class="line"><span class="cl">Fa0/1            Altn BLK <span class="m">19</span>        128.1    P2p
</span></span><span class="line"><span class="cl">Fa0/2            Desg FWD <span class="m">19</span>        128.2    P2p
</span></span><span class="line"><span class="cl">Fa0/3            Desg FWD <span class="m">19</span>        128.3    P2p
</span></span><span class="line"><span class="cl">Fa0/4            Root FWD <span class="m">19</span>        128.4    P2p
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>SW2</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW2#sh spanning-tree vlan <span class="m">10</span>
</span></span><span class="line"><span class="cl">VLAN0010
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Interface        Role Sts Cost      Prio.Nbr Type
</span></span><span class="line"><span class="cl">---------------- ---- --- --------- -------- --------------------------------
</span></span><span class="line"><span class="cl">Fa0/1            Desg FWD <span class="m">19</span>        128.1    P2p
</span></span><span class="line"><span class="cl">Fa0/2            Root FWD <span class="m">19</span>        128.2    P2p
</span></span><span class="line"><span class="cl">Fa0/5            Altn BLK <span class="m">19</span>        128.5    P2p
</span></span><span class="line"><span class="cl">Fa0/6            Desg FWD <span class="m">19</span>        128.6    P2p
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>SW3</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW3#sh spanning-tree vlan <span class="m">10</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Interface        Role Sts Cost      Prio.Nbr Type
</span></span><span class="line"><span class="cl">---------------- ---- --- --------- -------- --------------------------------
</span></span><span class="line"><span class="cl">Fa0/1            Desg FWD <span class="m">19</span>        128.1    P2p
</span></span><span class="line"><span class="cl">Fa0/3            Desg FWD <span class="m">19</span>        128.3    P2p
</span></span><span class="line"><span class="cl">Po2              Desg FWD <span class="m">9</span>         128.27   Shr
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>SW4</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.bash" data-lang=".bash"><span class="line"><span class="cl">SW4#sh spanning-tree vlan <span class="m">10</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Interface        Role Sts Cost      Prio.Nbr Type
</span></span><span class="line"><span class="cl">---------------- ---- --- --------- -------- --------------------------------
</span></span><span class="line"><span class="cl">Fa0/1            Desg FWD <span class="m">19</span>        128.1    P2p
</span></span><span class="line"><span class="cl">Fa0/3            Desg FWD <span class="m">19</span>        128.3    P2p
</span></span><span class="line"><span class="cl">Fa0/5            Desg FWD <span class="m">19</span>        128.5    P2p
</span></span><span class="line"><span class="cl">Po1              Root FWD <span class="m">9</span>         128.27   Shr
</span></span></code></pre></td></tr></table>
</div>
</div><p>Based of the previous outputs our topology now looks like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">dot</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &lt;!-- collapse=True --&gt;â†”</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">SW1</span> <span class="o">--</span> <span class="n">SW2</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">arrowtail</span><span class="o">=</span><span class="n">box</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW2</span> <span class="o">--</span> <span class="n">SW3</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="n">normal</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">SW4</span> <span class="o">--</span> <span class="n">SW1</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW4</span> <span class="o">--</span> <span class="n">SW2</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="n">box</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW4</span> <span class="o">--</span> <span class="n">SW3</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="n">normal</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">     <span class="n">PC1</span> <span class="p">[</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;PC1 [.101]&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">PC4</span> <span class="p">[</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;PC5 [.105]&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">     <span class="n">SW1</span> <span class="o">--</span> <span class="n">PC1</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW3</span> <span class="o">--</span> <span class="n">PC4</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="p">{</span><span class="n">rank</span> <span class="o">=</span> <span class="n">same</span><span class="p">;</span> <span class="n">SW1</span><span class="p">;</span> <span class="n">SW2</span><span class="p">;</span> <span class="n">SW3</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">     <span class="p">{</span><span class="n">rank</span> <span class="o">=</span> <span class="n">same</span><span class="p">;</span> <span class="n">PC1</span><span class="p">;</span> <span class="n">PC4</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="output_15_0.svg" alt="svg"></p>
<p>That means:</p>
<ul>
<li><code>SW1</code>s <strong>Fa0/1</strong> port is in <strong>blocking</strong> state (arrow endpoint is a box)</li>
<li><code>SW2</code>s <strong>Fa0/5</strong> port is in <strong>blocking</strong> state (arrow endpoint is a box)</li>
<li>all other ports are in <strong>forwarding</strong> state</li>
</ul>
<p>In this case there is <strong>only</strong> one way <code>PC1</code> could send frames to <code>PC5</code>  (red lines):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%%</span><span class="n">dot</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &lt;!-- collapse=True --&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="n">graph</span> <span class="n">mylab</span> <span class="p">{</span><span class="err">â†”</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">SW1</span> <span class="o">--</span> <span class="n">SW2</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">arrowtail</span><span class="o">=</span><span class="n">box</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW2</span> <span class="o">--</span> <span class="n">SW3</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="n">normal</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">SW4</span> <span class="o">--</span> <span class="n">SW1</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&#34;red&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW4</span> <span class="o">--</span> <span class="n">SW2</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="n">box</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW4</span> <span class="o">--</span> <span class="n">SW3</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="n">normal</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&#34;red&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">     <span class="n">PC1</span> <span class="p">[</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;PC1 [.101]&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">PC4</span> <span class="p">[</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&#34;PC5 [.105]&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">     <span class="n">SW1</span> <span class="o">--</span> <span class="n">PC1</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&#34;red&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="n">SW3</span> <span class="o">--</span> <span class="n">PC4</span> <span class="p">[</span><span class="nb">dir</span><span class="o">=</span><span class="n">both</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&#34;red&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="p">{</span><span class="n">rank</span> <span class="o">=</span> <span class="n">same</span><span class="p">;</span> <span class="n">SW1</span><span class="p">;</span> <span class="n">SW2</span><span class="p">;</span> <span class="n">SW3</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">     <span class="p">{</span><span class="n">rank</span> <span class="o">=</span> <span class="n">same</span><span class="p">;</span> <span class="n">PC1</span><span class="p">;</span> <span class="n">PC4</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="output_17_0.svg" alt="svg"></p>
<p>In the next posts I&rsquo;ll deal with <strong>IP routing</strong> on <strong>Layer 3</strong>.</p>

    

  </div>
  <div id="comments">
      
<div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "dorneanu" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
</main>
 






<div class="tl fixed list-pages lh-copy" id="contents-list"></div>



<div class="pagination tc tr-l db fixed-l bottom-2-l right-2-l mb3 mb0-l">
  
<a id="scroll-to-top" class="f6 o-0 link br2 ph2 pv1 mb1 bg-main-color pointer" onclick="topFunction()" style="color: #fff; visibility: hidden; display: none; transition: opacity .5s, visibility .5s;" title="back to top">back to top</a>
<br>
  <p class="mb0 mt2">
  <a href="https://blog.dornea.nu/2015/10/21/basic-layer-2-switching-using-cisco-packet-tracer/">prev</a>
  <a href="https://blog.dornea.nu/2015/11/17/openvpn-for-paranoids/">next</a>
  </p>
</div>

  <footer class="content-width mt0 mt5-l mb4 f6 center ph3 gray tc tl-l">
  <hr class="dn db-l ml0-l gray w3"><br>
  Powered by <a href="https://gohugo.io/" target="_blank" class="link gray dim">Hugo</a>, based on the <a href="https://github.com/lingxz/er" target="_blank" class="link gray dim">Er</a> theme.
  2009-2022 Victor Dorneanu - All rights reserved
  <a href="https://blog.dornea.nu/feed.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
</footer>

  



<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<style>.is-active-link::before { background-color: var(--secondary-color); }</style>




<script type="text/javascript">
var prevScrollpos = window.pageYOffset;
window.onscroll = function() {
  var currentScrollPos = window.pageYOffset;

  
  if (document.getElementById("tag-cloud") !== null) { 
    if (prevScrollpos > currentScrollPos) { 
      document.getElementById("tag-cloud").style.visibility = "visible";
      document.getElementById("tag-cloud").style.opacity = "1";
    } else {
      document.getElementById("tag-cloud").style.visibility = "hidden";
      document.getElementById("tag-cloud").style.opacity = "0";
    }
  }
  

  
  if (document.body.scrollTop > 1000 || document.documentElement.scrollTop > 1000) {
      document.getElementById("scroll-to-top").style.display = "inline";
      document.getElementById("scroll-to-top").style.visibility = "visible";
      document.getElementById("scroll-to-top").style.opacity = "1";
  } else {
      document.getElementById("scroll-to-top").style.visibility = "hidden";
      document.getElementById("scroll-to-top").style.opacity = "0";
  }
  
  prevScrollpos = currentScrollPos;
}


function topFunction() {
  document.body.scrollTop = 0; 
  document.documentElement.scrollTop = 0; 
}






if (document.getElementById("contents-list") !== null && document.getElementsByClassName("post-content").length !== 0) { 
  tocbot.init({
    
    tocSelector: '#contents-list',
    
    contentSelector: '.post-content',
    
    headingSelector: 'h1, h2, h3',
  });
}


</script>





<script>
 var glightbox = GLightbox({
     selector: '.glightbox'
 });
</script>

  
</body>
</html>
