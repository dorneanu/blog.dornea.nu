<!doctype html>
<html lang="en">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

  <title>Gentoo, systemd, consolekit, udev and some failed system update - blog.dornea.nu</title>
  <meta content='Gentoo, systemd, consolekit, udev and some failed system update - blog.dornea.nu' property='title' />
  <meta content='Gentoo, systemd, consolekit, udev and some failed system update - blog.dornea.nu' property='og:title' />


<meta property="og:description" content="OK, first some explanations:
systemd is a modern sysvinit &amp; RC replacement for Linux systems. It is supported in Gentoo as an alternate init system. (Source: http://wiki.gentoo.org/wiki/Systemd) ConsoleKit is a framework for defining and tracking users, login sessions, and seats. (Source: http://wiki.gentoo.org/wiki/ConsoleKit) udev is the device manager for the Linux kernel. Primarily, it manages device nodes in /dev and handles all user space actions when adding/removing devices. Also have a look at eudev a gentoo fork of udev." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.dornea.nu/2013/08/10/gentoo-systemd-consolekit-udev-and-some-failed-system-update/" />


<meta property="article:published_time" content="2013-08-10T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2013-08-10T00:00:00&#43;00:00"/>








<meta name="generator" content="Hugo 0.120.3">

<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" rel="stylesheet">
<link href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" rel="stylesheet"/>
<style type="text/css">/*https://coolors.co/afd5aa-f0f2ef-a69f98-3d3d3d-8c6057*/
:root {
  --main-color: #8C6056; 
  --secondary-color: #AFD5AA;
  --logo-text-color: #fff;
  --body-text-color: #3d3d3d;
  --heading-text-color: #383838;
  --background-color: #fff;
}</style>
<link href='https://blog.dornea.nu/css/tachyons.min.css' rel="stylesheet">
<link href='https://blog.dornea.nu/css/styles.css' rel="stylesheet">
<link rel="stylesheet" href="https://blog.dornea.nu/css/custom.css">
<link rel="stylesheet" href="https://blog.dornea.nu/css/syntax.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js"></script>


<link rel="icon" 
 
  href='https://blog.dornea.nu/favicon.ico'

type="image/x-icon"/>

<link href='https://blog.dornea.nu/feed.xml' rel="alternate" type="application/atom+xml" title="blog.dornea.nu" />



<script src="https://beamanalytics.b-cdn.net/beam.min.js" data-token="b8a4b728-8eda-42fb-8376-10168c622160" async></script>
</head>
<body class="global-font">
  <nav class=" flex-ns justify-between border-box pa3 pl3-l pr2-l mt1 mt0-ns" id="navbar">
  <div class="flex">
    <a class="f4 fw6 ttu no-underline dim bg-main-color pv1 ph2 br2" id="site-title" href='https://blog.dornea.nu/' title="Home">blog.dornea.nu</a>
  </div>
  
  <div class=" flex-ns mt2 mt0-ns pv1">
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/' title="Home">Home</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='http://dornea.nu' title="About">About</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/feed.xml' title="RSS">RSS</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/tags' title="Tags">Tags</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://brainfck.org' title="Zettelkasten">Zettelkasten</a>
    
  </div>
  
</nav>
  
<main class="center mv4 content-width ph3">
  <div class="f3 fw6 heading-color heading-font post-title">Gentoo, systemd, consolekit, udev and some failed system update</div>
  <p class="silver f6 mt1 mb4 post-meta">
    <time>10 Aug 2013</time> 
     | 
    

    
     ~
  

3 mins
|

    
    tags: [ <a href='https://blog.dornea.nu/tags/misc' class="link silver">misc</a> <a href='https://blog.dornea.nu/tags/wtf' class="link silver">wtf</a> <a href='https://blog.dornea.nu/tags/gentoo' class="link silver">gentoo</a> <a href='https://blog.dornea.nu/tags/systemd' class="link silver">systemd</a> <a href='https://blog.dornea.nu/tags/linux' class="link silver">linux</a> <a href='https://blog.dornea.nu/tags/update' class="link silver">update</a>  ]
    

  </p>
  <div class="lh-copy post-content">
    

      <p>OK, first some explanations:</p>
<ul>
<li><strong>systemd</strong> is a modern sysvinit &amp; RC replacement for Linux systems. It is supported in Gentoo as an alternate init system. (Source: <a href="http://wiki.gentoo.org/wiki/Systemd">http://wiki.gentoo.org/wiki/Systemd)</a></li>
<li><strong>ConsoleKit</strong> is a framework for defining and tracking users, login sessions, and seats. (Source:<a href="http://wiki.gentoo.org/wiki/ConsoleKit"> http://wiki.gentoo.org/wiki/ConsoleKit)</a></li>
<li><strong>udev</strong> is the device manager for the Linux kernel. Primarily, it manages device nodes in <tt>/dev</tt> and handles all user space actions when adding/removing devices. Also have a look at <a href="http://www.gentoo.org/proj/en/eudev" rel="nofollow">eudev</a> a gentoo fork of udev. (Source: <a href="http://wiki.gentoo.org/wiki/Udev">http://wiki.gentoo.org/wiki/Udev)</a></li>
</ul>
<p>At first look they don&rsquo;t seem to have sth in common. These are some other facts:</p>
<ul>
<li><em>systemd</em> and <em>udev</em> don&rsquo;t like each other</li>
<li><em>systemd</em> conflicts with <em>consolekit</em></li>
<li><em>consolekit</em> is not longer maintained</li>
<li><em>systemd</em> *is* <em>udev</em> (as systemd somehow includes udev)</li>
<li><em>polkit</em> depends on <em>consolekit</em> and they will both pull eath other</li>
<li><em>consolekit</em> has been replaced by logind which is being provided by <em>systemd</em></li>
<li>&hellip;and top of that <em>OpenRC</em> is somehow also involved in this whole thing.</li>
</ul>
<p>As you may have noticed: THIS IS A WHOLE BUNCH OF BULLSHIT GOING ON! I just wanted to update my Gentoo system and got stucked in some stupid conflicts between the mentioned packets. It took about one day to solve it (after reading lots of forum threads of people complaining about the same thing). Check:</p>
<ul>
<li><a href="http://forums.gentoo.org/viewtopic-t-920340-start-0.html" title="Force Disable ConsoleKit?">Force Disable Consolekit</a></li>
<li><a href="http://forums.gentoo.org/viewtopic-t-917584.html">Want to get rid of *kits. What should I be careful about?</a></li>
<li><a href="http://forums.gentoo.org/viewtopic-p-7367906.html">SOLVED gnome3 systemd udev and many other things</a></li>
</ul>
<p>Be sure you read them. They&rsquo;ve helped me a lot to understand this whole topic. So after all this is how I was able to solve it:</p>
<ul>
<li>Remove all USE flags related to consolekit:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># euse -D consolekit policykit upower udisks
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Make sure you have a <code>clean</code> /etc/make.conf. Here is mine:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1"># These settings were set by the catalyst build script that automatically</span>
</span></span><span class="line"><span class="cl"><span class="c1"># built this stage.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Please consult /usr/share/portage/config/make.conf.example for a more</span>
</span></span><span class="line"><span class="cl"><span class="c1"># detailed example.</span>
</span></span><span class="line"><span class="cl"><span class="n">CFLAGS</span><span class="o">=</span><span class="s2">&#34;-O2 -pipe&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">CXXFLAGS</span><span class="o">=</span><span class="s2">&#34;${CFLAGS}&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># WARNING: Changing your CHOST is not something that should be done lightly.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Please consult http://www.gentoo.org/doc/en/change-chost.xml before changing.</span>
</span></span><span class="line"><span class="cl"><span class="n">CHOST</span><span class="o">=</span><span class="s2">&#34;x86_64-pc-linux-gnu&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># These are the USE flags that were used in addition to what is provided by the</span>
</span></span><span class="line"><span class="cl"><span class="c1"># profile used for building.</span>
</span></span><span class="line"><span class="cl"><span class="n">ACCEPT_LICENSE</span><span class="o">=</span><span class="s2">&#34;*&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ACCEPT_KEYWORDS</span><span class="o">=</span><span class="s2">&#34;~amd64&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">AUTOCLEAN</span><span class="o">=</span><span class="s2">&#34;yes&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">VIDEO_CARDS</span><span class="o">=</span><span class="s2">&#34;intel&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">USE</span><span class="o">=</span><span class="s2">&#34;acpi smapi mmx sse sse2 cairo svg -kde qt4 qt3support dbus </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">     declarative jpeg png vorbis ogg pulse alsa usb sdl spice gtk gtk3 </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">     -gnome-shell -consolekit -policykit -upower -udisks&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">MAKEOPTS</span><span class="o">=</span><span class="s2">&#34;-j2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">FEATURES</span><span class="o">=</span><span class="s2">&#34;-userfetch&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#CCACHE_DIR=&#34;/var/tmp/ccache&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#CCACHE_SIZE=&#34;2G&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#source /var/lib/layman/make.conf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set PORTDIR for backward compatibility with various tools:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   gentoo-bashcomp - bug #478444</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   euse - bug #474574</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   euses and ufed - bug #478318</span>
</span></span><span class="line"><span class="cl"><span class="n">PORTDIR</span><span class="o">=</span><span class="s2">&#34;/usr/portage&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Make sure you have selected the right profile</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># eselect profile list
</span></span><span class="line"><span class="cl">Available profile symlink targets:
</span></span><span class="line"><span class="cl">  [1]   default/linux/amd64/13.0
</span></span><span class="line"><span class="cl">  [2]   default/linux/amd64/13.0/selinux
</span></span><span class="line"><span class="cl">  [3]   default/linux/amd64/13.0/desktop *
</span></span><span class="line"><span class="cl">  [4]   default/linux/amd64/13.0/desktop/gnome
</span></span><span class="line"><span class="cl">  [5]   default/linux/amd64/13.0/desktop/kde
</span></span><span class="line"><span class="cl">  [6]   default/linux/amd64/13.0/developer
</span></span><span class="line"><span class="cl">  [7]   default/linux/amd64/13.0/no-multilib
</span></span><span class="line"><span class="cl">  [8]   default/linux/amd64/13.0/x32
</span></span><span class="line"><span class="cl">  [9]   hardened/linux/amd64
</span></span><span class="line"><span class="cl">  [10]  hardened/linux/amd64/selinux
</span></span><span class="line"><span class="cl">  [11]  hardened/linux/amd64/no-multilib
</span></span><span class="line"><span class="cl">  [12]  hardened/linux/amd64/no-multilib/selinux
</span></span><span class="line"><span class="cl">  [13]  hardened/linux/amd64/x32
</span></span><span class="line"><span class="cl">  [14]  hardened/linux/uclibc/amd64
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Adjust profile settings</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># cd /etc/portage/profile
</span></span><span class="line"><span class="cl"># cat use.force
</span></span><span class="line"><span class="cl">-consolekit
</span></span><span class="line"><span class="cl"># cat use.mask
</span></span><span class="line"><span class="cl">consolekit
</span></span><span class="line"><span class="cl">-systemd
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Remove udev, consolekit and polkit</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># emerge -aC udev consolekit polkit
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Now you should be able to install systemd</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># emerge -pv systemd
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Now update your system</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># emerge --keep-going --jobs 4 --update --newuse --ask --deep --with-bdeps=y @world
</span></span></code></pre></td></tr></table>
</div>
</div><p>Additional steps to clean up your system:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># emerge -a --depclean
</span></span><span class="line"><span class="cl"># revdep-rebuild -- -q --keep-going
</span></span></code></pre></td></tr></table>
</div>
</div>
    

  </div>
  <div id="comments">
      

  </div>
</main>
 








<div class="pagination tc tr-l db fixed-l bottom-2-l right-2-l mb3 mb0-l">
  
<a id="scroll-to-top" class="f6 o-0 link br2 ph2 pv1 mb1 bg-main-color pointer" onclick="topFunction()" style="color: #fff; visibility: hidden; display: none; transition: opacity .5s, visibility .5s;" title="back to top">back to top</a>
<br>
  <p class="mb0 mt2">
  <a href="https://blog.dornea.nu/2013/08/09/links-of-the-week-8/">prev</a>
  <a href="https://blog.dornea.nu/2013/08/23/links-of-the-week-10/">next</a>
  </p>
</div>

  <footer class="content-width mt0 mt5-l mb4 f6 center ph3 gray tc tl-l">
  <hr class="dn db-l ml0-l gray w3"><br>
  Powered by <a href="https://gohugo.io/" target="_blank" class="link gray dim">Hugo</a>, based on the <a href="https://github.com/lingxz/er" target="_blank" class="link gray dim">Er</a> theme.
  2009-2022 Victor Dorneanu - All rights reserved
  <a href="https://blog.dornea.nu/feed.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
</footer>

  






<script type="text/javascript">
var prevScrollpos = window.pageYOffset;
window.onscroll = function() {
  var currentScrollPos = window.pageYOffset;

  
  if (document.getElementById("tag-cloud") !== null) { 
    if (prevScrollpos > currentScrollPos) { 
      document.getElementById("tag-cloud").style.visibility = "visible";
      document.getElementById("tag-cloud").style.opacity = "1";
    } else {
      document.getElementById("tag-cloud").style.visibility = "hidden";
      document.getElementById("tag-cloud").style.opacity = "0";
    }
  }
  

  
  if (document.body.scrollTop > 1000 || document.documentElement.scrollTop > 1000) {
      document.getElementById("scroll-to-top").style.display = "inline";
      document.getElementById("scroll-to-top").style.visibility = "visible";
      document.getElementById("scroll-to-top").style.opacity = "1";
  } else {
      document.getElementById("scroll-to-top").style.visibility = "hidden";
      document.getElementById("scroll-to-top").style.opacity = "0";
  }
  
  prevScrollpos = currentScrollPos;
}


function topFunction() {
  document.body.scrollTop = 0; 
  document.documentElement.scrollTop = 0; 
}







</script>





<script>
 var glightbox = GLightbox({
     selector: '.glightbox'
 });
</script>

  
</body>
</html>
