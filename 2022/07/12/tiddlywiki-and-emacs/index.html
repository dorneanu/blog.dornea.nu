<!doctype html>
<html lang="en">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

  <title>TiddlyWiki and Emacs - blog.dornea.nu</title>
  <meta content='TiddlyWiki and Emacs - blog.dornea.nu' property='title' />
  <meta content='TiddlyWiki and Emacs - blog.dornea.nu' property='og:title' />


<meta property="og:description" content="Since my last post on reddit asking for some help regarding Emacs and TiddlyWikis REST API I gained some elisp knowledge I&rsquo;d like to share. Maybe you want to go directly to the Emacs configuration. 
TiddlyWiki 5 For those of you who haven&rsquo;t heard of TiddlyWiki yet:
 TiddlyWiki is a personal wiki and a non-linear notebook for organising and sharing complex information. It is an open-source single page application wiki in the form of a single HTML file that includes CSS, JavaScript, and the content." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.dornea.nu/2022/07/12/tiddlywiki-and-emacs/" />


<meta property="article:published_time" content="2022-07-12T07:00:00&#43;02:00"/>

<meta property="article:modified_time" content="2022-07-13T15:49:41&#43;02:00"/>








<meta name="generator" content="Hugo 0.89.4" />

<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" rel="stylesheet">
<link href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" rel="stylesheet"/>
<style type="text/css">/*https://coolors.co/afd5aa-f0f2ef-a69f98-3d3d3d-8c6057*/
:root {
  --main-color: #8C6056; 
  --secondary-color: #AFD5AA;
  --logo-text-color: #fff;
  --body-text-color: #3d3d3d;
  --heading-text-color: #383838;
  --background-color: #fff;
}</style>
<link href='https://blog.dornea.nu/css/tachyons.min.css' rel="stylesheet">
<link href='https://blog.dornea.nu/css/styles.css' rel="stylesheet">
<link rel="stylesheet" href="https://blog.dornea.nu/css/custom.css">
<link rel="stylesheet" href="https://blog.dornea.nu/css/syntax.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js"></script>


<link rel="icon" 
 
  href='https://blog.dornea.nu/favicon.ico'

type="image/x-icon"/>

<link href='https://blog.dornea.nu/feed.xml' rel="alternate" type="application/atom+xml" title="blog.dornea.nu" />

</head>
<body class="global-font">
  <nav class=" flex-ns justify-between border-box pa3 pl3-l pr2-l mt1 mt0-ns" id="navbar">
  <div class="flex">
    <a class="f4 fw6 ttu no-underline dim bg-main-color pv1 ph2 br2" id="site-title" href='https://blog.dornea.nu/' title="Home">blog.dornea.nu</a>
  </div>
  
  <div class=" flex-ns mt2 mt0-ns pv1">
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/' title="Home">Home</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='http://dornea.nu' title="About">About</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/feed.xml' title="RSS">RSS</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/tags' title="Tags">Tags</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://brainfck.org' title="Zettelkasten">Zettelkasten</a>
    
  </div>
  
</nav>
  
<main class="center mv4 content-width ph3">
  <div class="f3 fw6 heading-color heading-font post-title">TiddlyWiki and Emacs</div>
  <p class="silver f6 mt1 mb4 post-meta">
    <time>12 Jul 2022</time> 
     | 
    

    
     ~
  

12 mins
|

    
    tags: [ <a href='https://blog.dornea.nu/tags/emacs' class="link silver">emacs</a> <a href='https://blog.dornea.nu/tags/tiddlywiki' class="link silver">tiddlywiki</a> <a href='https://blog.dornea.nu/tags/elisp' class="link silver">elisp</a>  ]
    

  </p>
  <div class="lh-copy post-content"><p>Since my <a href="https://www.reddit.com/r/emacs/comments/pkuhqd/emacs_and_tiddlywiki_anyone/">last post on reddit</a> asking for some help regarding Emacs and TiddlyWikis REST API
I gained some <code>elisp</code> knowledge I&rsquo;d like to share.
<span class="sidenote-number"><small class="sidenote">
Maybe you want to go directly to the <a href="https://github.com/dorneanu/dotfiles/blob/master/dot_doom.d/config.org#tiddlywiki">Emacs configuration</a>.
</small></span></p>
<h2 id="tiddlywiki-5">TiddlyWiki 5</h2>
<p>For those of you who haven&rsquo;t heard of TiddlyWiki yet:</p>
<blockquote>
<p>TiddlyWiki is a personal wiki and a non-linear notebook for organising and
sharing complex information. It is an open-source single page application wiki
in the form of a single HTML file that includes CSS, JavaScript, and the
content. It is designed to be easy to customize and re-shape depending on
application. It facilitates re-use of content by dividing it into small pieces
called Tiddlers. &ndash; <a href="https://en.wikipedia.org/wiki/TiddlyWiki">Wikipedia</a></p>
</blockquote>
<p>You use the wiki as a <strong>single HTML page</strong> or via <code>nodejs</code>. With <code>nodejs</code> we can talk to
Tiddlywiki via its REST API.
<span class="sidenote-number"><small class="sidenote">
I&rsquo;ve been using TiddlyWikis REST API to serve a instance via AWS Lambda and DynamoDB
for the data storage. The project itself is called <a href="https://github.com/dorneanu/widdly">widdly</a> and there is also a demo at
<a href="https://tiddly.info/serverless">tiddly.info/serverless</a>.
</small></span>
Every single page inside the wiki is called <code>tiddler</code>.</p>
<blockquote>
<p>On the philosophy of <a href="https://tiddlywiki.com/static/Philosophy%2520of%2520Tiddlers.html">tiddlers</a>: &ldquo;The purpose of recording and organising information is so that it can be used again. The value of recorded information is directly proportional to the ease with which it can be re-used.&rdquo;</p>
</blockquote>
<p>A <code>tiddler</code> has following <a href="https://tiddlywiki.com/prerelease/static/TiddlyWeb%2520JSON%2520tiddler%2520format.html">format</a>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
	<span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;HelloThere&#34;</span><span class="p">,</span>
	<span class="nt">&#34;tags&#34;</span><span class="p">:</span> <span class="s2">&#34;FirstTag [[Second Tag]]&#34;</span><span class="p">,</span>
	<span class="nt">&#34;my-custom-field&#34;</span><span class="p">:</span> <span class="s2">&#34;Field value&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 1:</span>
  Tiddler JSON format
</div>
<p>Next I&rsquo;ll show you how to setup your TiddlyWiki instance.
<span class="sidenote-number"><small class="sidenote">
I have a public &ldquo;digital garden&rdquo; aka wiki available at <a href="https://brainfck.org">https://brainfck.org</a>
</small></span></p>
<h3 id="basic-setup">Basic setup</h3>
<p>I use <code>node.js</code> to run my TiddlyWiki instance.
<span class="sidenote-number"><small class="sidenote">
The REST API is only available within the nodeJS environment.
</small></span>
For isolation reasons I use <code>Docker</code> to run it. Here is my <code>Dockerfile</code>:</p>
<p><a id="code-snippet--tw5-dockerfile"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-docker" data-lang="docker"><span class="k">FROM</span><span class="s"> mhart/alpine-node</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># Create a group and user</span><span class="err">
</span><span class="err"></span><span class="k">RUN</span> addgroup -g <span class="m">984</span> -S appgroup<span class="err">
</span><span class="err"></span><span class="k">RUN</span> adduser -h /DATA/wiki -u <span class="m">1000</span> -S appuser -G appgroup<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># Tell docker that all future commands should run as the appuser user</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">ENV</span> <span class="nv">TW_BASE</span><span class="o">=</span>/DATA <span class="nv">TW_NAME</span><span class="o">=</span>wiki <span class="nv">TW_USER</span><span class="o">=</span><span class="s2">&#34;xxx&#34;</span> <span class="nv">TW_PASSWORD</span><span class="o">=</span><span class="s2">&#34;xxx&#34;</span> <span class="nv">TW_LAZY</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="err">
</span><span class="err"></span><span class="k">ENV</span> TW_PATH <span class="si">${</span><span class="nv">TW_BASE</span><span class="si">}</span>/<span class="si">${</span><span class="nv">TW_NAME</span><span class="si">}</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">WORKDIR</span><span class="s"> ${TW_BASE}</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">RUN</span> npm install -g npm@8.10.0<span class="err">
</span><span class="err"></span><span class="k">RUN</span> npm install -g tiddlywiki http-server<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># COPY plugins/felixhayashi /usr/lib/node_modules/tiddlywiki/plugins/felixhayashi</span><span class="err">
</span><span class="err"></span><span class="c"># RUN ls -la /usr/lib/node_modules/tiddlywiki/plugins</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> start.sh <span class="si">${</span><span class="nv">TW_BASE</span><span class="si">}</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># Change ownership</span><span class="err">
</span><span class="err"></span><span class="k">RUN</span> chown appuser:appgroup /DATA/start.sh<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 8181</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">USER</span><span class="s"> appuser</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;/DATA/start.sh&#34;</span><span class="p">]</span><span class="err">
</span><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;/DATA/start.sh&#34;</span><span class="p">]</span><span class="err">
</span></code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--tw5-dockerfile">Code Snippet 2</a>:</span>
  Dockerfile for running TiddlyWiki 5 using alpine
</div>
<p>And as for <code>start.sh</code>:</p>
<p><a id="code-snippet--tw5-docker-start-sh"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="cp">#!/usr/bin/env sh
</span><span class="cp"></span>
<span class="c1"># Start image server</span>
http-server -p <span class="m">82</span> /DATA/wiki/images <span class="p">&amp;</span>

<span class="c1"># Start tiddlywiki server</span>
tiddlywiki /DATA/wiki --listen <span class="nv">port</span><span class="o">=</span><span class="m">8181</span> <span class="nv">host</span><span class="o">=</span>0.0.0.0 csrf-disable<span class="o">=</span>yes
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--tw5-docker-start-sh">Code Snippet 3</a>:</span>
  Bash script to start a simple http-server (for uploading images) and the tiddlywiki server instance (node.js)
</div>
<p>Now you should be able to call the API (via <code>curl</code> for example):</p>
<p><a id="code-snippet--tw5-get-tiddler-emacs"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">curl http://127.0.0.1:8181/recipes/default/tiddlers/Emacs <span class="p">|</span> jq
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--tw5-get-tiddler-emacs">Code Snippet 4</a>:</span>
  Now you should be able to call the API (via <code>curl</code> for example).
</div>
<p><a id="code-snippet--tw5-get-tiddler-emacs-response"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="o">{</span>
  <span class="s2">&#34;title&#34;</span>: <span class="s2">&#34;Emacs&#34;</span>,
  <span class="s2">&#34;created&#34;</span>: <span class="s2">&#34;20210623082136326&#34;</span>,
  <span class="s2">&#34;modified&#34;</span>: <span class="s2">&#34;20210623082138258&#34;</span>,
  <span class="s2">&#34;tags&#34;</span>: <span class="s2">&#34;Topics&#34;</span>,
  <span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;text/vnd.tiddlywiki&#34;</span>,
  <span class="s2">&#34;revision&#34;</span>: 0,
  <span class="s2">&#34;bag&#34;</span>: <span class="s2">&#34;default&#34;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--tw5-get-tiddler-emacs-response">Code Snippet 5</a>:</span>
  The REST API will send back a JSON response.
</div>
<h2 id="request-dot-el">request.el</h2>
<p>I use <a href="https://tkf.github.io/emacs-request/">request.el</a>
<span class="sidenote-number"><small class="sidenote">
I know there might be better alternatives. But in my case it&rsquo;s been totally
sufficient and Elisp beginner friendly.
</small></span>
for crafting and sending HTTP requests. So what is <code>request.el</code> all about?</p>
<blockquote>
<p>Request.el is a HTTP request library with multiple backends. It supports url.el
which is shipped with Emacs and curl command line program. User can use curl
when s/he has it, as curl is more reliable than url.el. Library author can use
request.el to avoid imposing external dependencies such as curl to users while
giving richer experience for users who have curl. &ndash; <a href="https://tkf.github.io/emacs-request/">Source</a></p>
</blockquote>
<h3 id="get">GET</h3>
<p>Let&rsquo;s have a look how a simple (GET) API call looks like:</p>
<p><a id="code-snippet--request-get-chuck-norris"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">let*</span>
    <span class="p">((</span><span class="nv">httpRequest</span>
      <span class="p">(</span><span class="nv">request</span> <span class="s">&#34;https://api.chucknorris.io/jokes/random&#34;</span>
        <span class="nb">:parser</span> <span class="ss">&#39;json-read</span>
        <span class="nb">:sync</span> <span class="no">t</span>
        <span class="nb">:success</span> <span class="p">(</span><span class="nb">cl-function</span>
                  <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;key</span> <span class="nv">data</span> <span class="kp">&amp;allow-other-keys</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;I sent: %S&#34;</span> <span class="nv">data</span><span class="p">)))))</span>

     <span class="p">(</span><span class="nv">data</span> <span class="p">(</span><span class="nv">request-response-data</span> <span class="nv">httpRequest</span><span class="p">)))</span>

  <span class="c1">;; Print information</span>
 <span class="p">(</span><span class="nb">cl-loop</span> <span class="nv">for</span> <span class="p">(</span><span class="nv">key</span> <span class="o">.</span> <span class="nv">value</span><span class="p">)</span> <span class="nv">in</span> <span class="nv">data</span>
      <span class="nv">collect</span> <span class="p">(</span><span class="nf">cons</span> <span class="nv">key</span> <span class="nv">value</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--request-get-chuck-norris">Code Snippet 6</a>:</span>
  Get a random Chuck Norris joke
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">((</span><span class="nv">categories</span> <span class="o">.</span>
             <span class="p">[])</span>
 <span class="p">(</span><span class="nv">created_at</span> <span class="o">.</span> <span class="s">&#34;2020-01-05 13:42:19.576875&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">icon_url</span> <span class="o">.</span> <span class="s">&#34;https://assets.chucknorris.host/img/avatar/chuck-norris.png&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">id</span> <span class="o">.</span> <span class="s">&#34;YNmylryESKCeA5-TJKm_9g&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">updated_at</span> <span class="o">.</span> <span class="s">&#34;2020-01-05 13:42:19.576875&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">url</span> <span class="o">.</span> <span class="s">&#34;https://api.chucknorris.io/jokes/YNmylryESKCeA5-TJKm_9g&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">value</span> <span class="o">.</span> <span class="s">&#34;The descendents of Chuck Norris have divided into two widely known cultures: New Jersey and New York.&#34;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="post">POST</h3>
<p>Sending a <code>POST</code> request is also an easy task:</p>
<p><a id="code-snippet--request-post-request-httpbin"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">let*</span>
    <span class="p">((</span><span class="nv">httpRequest</span>
      <span class="p">(</span><span class="nv">request</span> <span class="s">&#34;http://httpbin.org/post&#34;</span>
        <span class="nb">:type</span> <span class="s">&#34;POST&#34;</span>
        <span class="nb">:data</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;key&#34;</span> <span class="o">.</span> <span class="s">&#34;value&#34;</span><span class="p">)</span> <span class="p">(</span><span class="s">&#34;key2&#34;</span> <span class="o">.</span> <span class="s">&#34;value2&#34;</span><span class="p">))</span>
        <span class="nb">:parser</span> <span class="ss">&#39;json-read</span>
        <span class="nb">:sync</span> <span class="no">t</span>
        <span class="nb">:success</span> <span class="p">(</span><span class="nb">cl-function</span>
                  <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;key</span> <span class="nv">data</span> <span class="kp">&amp;allow-other-keys</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;I sent: %S&#34;</span> <span class="nv">data</span><span class="p">)))))</span>

     <span class="p">(</span><span class="nv">data</span> <span class="p">(</span><span class="nv">request-response-data</span> <span class="nv">httpRequest</span><span class="p">))</span>
     <span class="p">(</span><span class="nv">err</span> <span class="p">(</span><span class="nv">request-response-error-thrown</span> <span class="nv">httpRequest</span><span class="p">))</span>
     <span class="p">(</span><span class="nv">status</span> <span class="p">(</span><span class="nv">request-response-status-code</span> <span class="nv">httpRequest</span><span class="p">)))</span>

  <span class="c1">;; Print information</span>
 <span class="p">(</span><span class="nb">cl-loop</span> <span class="nv">for</span> <span class="p">(</span><span class="nv">key</span> <span class="o">.</span> <span class="nv">value</span><span class="p">)</span> <span class="nv">in</span> <span class="nv">data</span>
      <span class="nv">collect</span> <span class="p">(</span><span class="nf">cons</span> <span class="nv">key</span> <span class="nv">value</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--request-post-request-httpbin">Code Snippet 7</a>:</span>
  POST request with data
</div>
<p>And here is the result:</p>
<p><a id="code-snippet--request-post-request-httpbin-response"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">((</span><span class="nv">args</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">data</span> <span class="o">.</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">files</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">form</span>
  <span class="p">(</span><span class="nv">key</span> <span class="o">.</span> <span class="s">&#34;value&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">key2</span> <span class="o">.</span> <span class="s">&#34;value2&#34;</span><span class="p">))</span>
 <span class="p">(</span><span class="nv">headers</span>
  <span class="p">(</span><span class="nv">Accept</span> <span class="o">.</span> <span class="s">&#34;*/*&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">Accept-Encoding</span> <span class="o">.</span> <span class="s">&#34;deflate, gzip, br, zstd&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">Content-Length</span> <span class="o">.</span> <span class="s">&#34;21&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">Content-Type</span> <span class="o">.</span> <span class="s">&#34;application/x-www-form-urlencoded&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">Host</span> <span class="o">.</span> <span class="s">&#34;httpbin.org&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">User-Agent</span> <span class="o">.</span> <span class="s">&#34;curl/7.83.1&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">X-Amzn-Trace-Id</span> <span class="o">.</span> <span class="s">&#34;Root=1-62cdbc5c-52d3ad32436c1cb8778808e5&#34;</span><span class="p">))</span>
 <span class="p">(</span><span class="nv">json</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">origin</span> <span class="o">.</span> <span class="s">&#34;127.0.0.1&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">url</span> <span class="o">.</span> <span class="s">&#34;http://httpbin.org/post&#34;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--request-post-request-httpbin-response">Code Snippet 8</a>:</span>
  POST response as list of Elisp cons cells
</div>
<h2 id="emacs">Emacs</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-lisp" data-lang="lisp"><span class="c1">;; default tiddlywiki base path</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">tiddlywiki-base-path</span> <span class="s">&#34;http://127.0.0.1:8181/recipes/default/tiddlers/&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="get-tiddler">GET tiddler</h3>
<p>Let&rsquo;s <a href="https://tiddlywiki.com/prerelease/static/WebServer%2520API%253A%2520Get%2520Tiddler.html">GET</a> a tiddler:</p>
<p><a id="code-snippet--request-get-tiddler-emacs"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">let*</span>
    <span class="p">((</span><span class="nv">httpRequest</span>
      <span class="p">(</span><span class="nv">request</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">tiddlywiki-base-path</span> <span class="s">&#34;Emacs&#34;</span><span class="p">)</span>
        <span class="nb">:parser</span> <span class="ss">&#39;json-read</span>
        <span class="nb">:sync</span> <span class="no">t</span>
        <span class="nb">:success</span> <span class="p">(</span><span class="nb">cl-function</span>
                  <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;key</span> <span class="nv">data</span> <span class="kp">&amp;allow-other-keys</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;I sent: %S&#34;</span> <span class="nv">data</span><span class="p">)))))</span>

     <span class="p">(</span><span class="nv">data</span> <span class="p">(</span><span class="nv">request-response-data</span> <span class="nv">httpRequest</span><span class="p">))</span>
     <span class="p">(</span><span class="nv">err</span> <span class="p">(</span><span class="nv">request-response-error-thrown</span> <span class="nv">httpRequest</span><span class="p">))</span>
     <span class="p">(</span><span class="nv">status</span> <span class="p">(</span><span class="nv">request-response-status-code</span> <span class="nv">httpRequest</span><span class="p">)))</span>

  <span class="c1">;; Print information</span>
 <span class="p">(</span><span class="nb">cl-loop</span> <span class="nv">for</span> <span class="p">(</span><span class="nv">key</span> <span class="o">.</span> <span class="nv">value</span><span class="p">)</span> <span class="nv">in</span> <span class="nv">data</span>
      <span class="nv">collect</span> <span class="p">(</span><span class="nf">cons</span> <span class="nv">key</span> <span class="nv">value</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--request-get-tiddler-emacs">Code Snippet 9</a>:</span>
  Get a tiddler by name ("Emacs")
</div>
<p><a id="code-snippet--request-get-tiddler-emacs-response"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">((</span><span class="nv">title</span> <span class="o">.</span> <span class="s">&#34;Emacs&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">created</span> <span class="o">.</span> <span class="s">&#34;20210623082136326&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">modified</span> <span class="o">.</span> <span class="s">&#34;20210623082138258&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">tags</span> <span class="o">.</span> <span class="s">&#34;Topics&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">type</span> <span class="o">.</span> <span class="s">&#34;text/vnd.tiddlywiki&#34;</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">revision</span> <span class="o">.</span> <span class="mi">0</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">bag</span> <span class="o">.</span> <span class="s">&#34;default&#34;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--request-get-tiddler-emacs-response">Code Snippet 10</a>:</span>
  Response as list of Elisp cons cells
</div>
<h3 id="put-a-new-tiddler">PUT a new tiddler</h3>
<p><a href="https://tiddlywiki.com/prerelease/static/WebServer%2520API%253A%2520Put%2520Tiddler.html">Creating a new tiddler</a> is also simple. Using <a href="https://github.com/federicotdn/verb">ob-verb</a>
<span class="sidenote-number"><small class="sidenote">
This package is really helpful especially when you do literate programming with <a href="https://orgmode.org/worg/org-contrib/babel/">org-babel</a>.
</small></span>
let&rsquo;s add a <code>PUT</code> request to the API:</p>
<p><a id="code-snippet--put-new-tiddler-pseudo"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">PUT http://127.0.0.1:8181/recipes/default/tiddlers/I%20love%20Elisp
x-requested-with: TiddlyWiki
Content-Type: application/json; charset=utf-8

{
    &#34;title&#34;: &#34;I love Elisp&#34;,
    &#34;tags&#34;: &#34;Emacs [[I Love]]&#34;,
    &#34;send-with&#34;: &#34;verb&#34;,
    &#34;text&#34;: &#34;This rocks!&#34;
}
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--put-new-tiddler-pseudo">Code Snippet 11</a>:</span>
  Sample request for creating a new tiddler
</div>
<p>Check if tiddler was indeed created:</p>
<p><a id="code-snippet--get-tiddler-verb"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">GET http://127.0.0.1:8181/recipes/default/tiddlers/I%20love%20Elisp
x-requested-with: TiddlyWiki
Accept: application/json; charset=utf-8
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--get-tiddler-verb">Code Snippet 12</a>:</span>
  GET request using <code>verb</code>
</div>
<p><a id="code-snippet--put-new-tiddler-pseudo-response"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="n">Date</span><span class="o">:</span> <span class="l">Wed, 13 Jul 2022 10:03:27 GMT</span>
<span class="n">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<span class="n">Keep-Alive</span><span class="o">:</span> <span class="l">timeout=5</span>
<span class="n">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

<span class="p">{</span>
  <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;I love Elisp&#34;</span><span class="p">,</span>
  <span class="nt">&#34;tags&#34;</span><span class="p">:</span> <span class="s2">&#34;Emacs [[I Love]]&#34;</span><span class="p">,</span>
  <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;send-with&#34;</span><span class="p">:</span> <span class="s2">&#34;verb&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;This rocks!&#34;</span><span class="p">,</span>
  <span class="nt">&#34;revision&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&#34;bag&#34;</span><span class="p">:</span> <span class="s2">&#34;default&#34;</span><span class="p">,</span>
  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;text/vnd.tiddlywiki&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--put-new-tiddler-pseudo-response">Code Snippet 13</a>:</span>
  A new tiddler was created
</div>
<p>Now let&rsquo;s translate that to <code>request.el</code> code. This I&rsquo;ll some extra complexity: I&rsquo;ll add
a function (<code>defun</code>) to <code>PUT</code> a new tiddler for us, where <strong>name</strong>, <strong>tags</strong> and <strong>body</strong> of the tiddler are variable.</p>
<p><a id="code-snippet--request-insert-function"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="hl"><span class="lnt"> 6
</span></span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="hl"><span class="lnt">13
</span></span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="hl"><span class="lnt">21
</span></span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; Define function for inserting new tiddlers</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">insert-tiddler</span><span class="p">(</span><span class="nv">name</span> <span class="nv">tags</span> <span class="nv">body</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let*</span>
  <span class="p">(</span>
   <span class="p">(</span><span class="nv">tiddler-title</span> <span class="nv">name</span><span class="p">)</span>
<span class="hl">   <span class="p">(</span><span class="nv">url-path</span> <span class="p">(</span><span class="nv">url-hexify-string</span> <span class="nv">tiddler-title</span><span class="p">))</span>
</span>   <span class="p">(</span><span class="nv">tiddler-tags</span> <span class="nv">tags</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">tiddler-body</span> <span class="nv">body</span><span class="p">)</span>

   <span class="p">(</span><span class="nv">httpRequest</span>
    <span class="p">(</span><span class="nv">request</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">tiddlywiki-base-path</span> <span class="nv">url-path</span><span class="p">)</span>
      <span class="nb">:type</span> <span class="s">&#34;PUT&#34;</span>
<span class="hl">      <span class="nb">:data</span> <span class="p">(</span><span class="nv">json-encode</span>
</span>             <span class="o">`</span><span class="p">(</span>
               <span class="p">(</span><span class="s">&#34;title&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">tiddler-title</span><span class="p">)</span>
               <span class="p">(</span><span class="s">&#34;created&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nf">format-time-string</span> <span class="s">&#34;%Y%m%d%H%M%S%3N&#34;</span><span class="p">))</span>
               <span class="p">(</span><span class="s">&#34;modified&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nf">format-time-string</span> <span class="s">&#34;%Y%m%d%H%M%S%3N&#34;</span><span class="p">))</span>
               <span class="p">(</span><span class="s">&#34;tags&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">tiddler-tags</span><span class="p">)</span>
               <span class="p">(</span><span class="s">&#34;text&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">tiddler-body</span><span class="p">)</span>
               <span class="p">(</span><span class="s">&#34;type&#34;</span> <span class="o">.</span> <span class="s">&#34;text/vnd.tiddlywiki&#34;</span><span class="p">)))</span>
<span class="hl">      <span class="nb">:headers</span> <span class="o">&#39;</span><span class="p">(</span>
</span>                 <span class="p">(</span><span class="s">&#34;Content-Type&#34;</span> <span class="o">.</span> <span class="s">&#34;application/json&#34;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&#34;X-Requested-With&#34;</span> <span class="o">.</span> <span class="s">&#34;Tiddlywiki&#34;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&#34;Accept&#34;</span> <span class="o">.</span> <span class="s">&#34;application/json&#34;</span><span class="p">))</span>
      <span class="nb">:encoding</span> <span class="ss">&#39;utf-8</span>
      <span class="nb">:sync</span> <span class="no">t</span>
      <span class="nb">:complete</span>
      <span class="p">(</span><span class="nv">function*</span>
       <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;key</span> <span class="nv">data</span> <span class="kp">&amp;allow-other-keys</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Inside function: %s&#34;</span> <span class="nv">data</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">when</span> <span class="nv">data</span>
           <span class="p">(</span><span class="nb">with-current-buffer</span> <span class="p">(</span><span class="nf">get-buffer-create</span> <span class="s">&#34;*request demo*&#34;</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">erase-buffer</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nv">request-response-data</span> <span class="nv">data</span><span class="p">))</span>
             <span class="p">(</span><span class="nv">pop-to-buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))))))</span>
      <span class="nb">:error</span>
      <span class="p">(</span><span class="nv">function*</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;key</span> <span class="nv">error-thrown</span> <span class="nv">&amp;allow-other-keys&amp;rest</span> <span class="nv">_</span><span class="p">)</span>
                   <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Got error: %S&#34;</span> <span class="nv">error-thrown</span><span class="p">)))</span>
      <span class="p">)))</span>

  <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s:%s&#34;</span>
          <span class="p">(</span><span class="nv">request-response-headers</span> <span class="nv">httpRequest</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">request-response-status-code</span> <span class="nv">httpRequest</span><span class="p">)</span>
          <span class="p">)))</span>

<span class="c1">;; Insert 2 tiddlers</span>
<span class="p">(</span><span class="nv">insert-tiddler</span> <span class="s">&#34;I love Elisp&#34;</span> <span class="s">&#34;Elisp [[I Love]]&#34;</span> <span class="s">&#34;This rocks!&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--request-insert-function">Code Snippet 14</a>:</span>
  Create new function for inserting new tiddlers
</div>
<p><a id="code-snippet--request-insert-function-created"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="s">&#34;((etag . \&#34;default/I%20love%20Elisp/61:\&#34;) (content-type . text/plain) (date . Wed, 13 Jul 2022 12:30:33 GMT) (connection . keep-alive) (keep-alive . timeout=5)):204&#34;</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--request-insert-function-created">Code Snippet 15</a>:</span>
  New tiddler was created
</div>
<p>Some explanations:</p>
<ul>
<li>in line 6 I URL encode the <code>tiddler-title</code>
<ul>
<li><code>I love Elisp</code> should become <code>I%20love%20Elisp</code></li>
</ul>
</li>
<li>in line 21 some headers are set
<ul>
<li><code>X-Requested-With</code> is required to be set to <code>TiddlyWiki</code></li>
<li><code>Content-Type</code> should be <code>json</code></li>
<li>we also accept <code>json</code> as a response</li>
</ul>
</li>
<li>in line 13 we specify the <code>data</code> to be sent to the API
<ul>
<li>each field (key, value sets) is set accordingly (see <a href="#code-snippet--request-get-tiddler-emacs-response">10</a>)</li>
<li>I set the <code>created</code> and <code>modified</code> fields using <code>format-time-string</code></li>
</ul>
</li>
</ul>
<p>Now let&rsquo;s check again if tiddler really exists:</p>
<p><a id="code-snippet--get-tiddler-verb-new-tiddler"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">GET http://127.0.0.1:8181/recipes/default/tiddlers/I%20love%20Elisp
x-requested-with: TiddlyWiki
Accept: application/json; charset=utf-8
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--get-tiddler-verb-new-tiddler">Code Snippet 16</a>:</span>
  Check if new tiddler exists
</div>
<p><a id="code-snippet--get-tiddler-verb-new-tiddler-response"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="n">Date</span><span class="o">:</span> <span class="l">Wed, 13 Jul 2022 12:40:22 GMT</span>
<span class="n">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<span class="n">Keep-Alive</span><span class="o">:</span> <span class="l">timeout=5</span>
<span class="n">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

<span class="p">{</span>
  <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;I love Elisp&#34;</span><span class="p">,</span>
  <span class="nt">&#34;created&#34;</span><span class="p">:</span> <span class="s2">&#34;20220713143033566&#34;</span><span class="p">,</span>
  <span class="nt">&#34;modified&#34;</span><span class="p">:</span> <span class="s2">&#34;20220713143033566&#34;</span><span class="p">,</span>
  <span class="nt">&#34;tags&#34;</span><span class="p">:</span> <span class="s2">&#34;Elisp [[I Love]]&#34;</span><span class="p">,</span>
  <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;This rocks!&#34;</span><span class="p">,</span>
  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;text/vnd.tiddlywiki&#34;</span><span class="p">,</span>
  <span class="nt">&#34;revision&#34;</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span>
  <span class="nt">&#34;bag&#34;</span><span class="p">:</span> <span class="s2">&#34;default&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--get-tiddler-verb-new-tiddler-response">Code Snippet 17</a>:</span>
  It does exist!
</div>
<h2 id="use-cases">Use cases</h2>
<p>Now what can you do with this little custom functions? Let me share my use cases.</p>
<h3 id="add-bookmark">Add bookmark</h3>
<p>A bookmark in my TiddlyWiki represents a tiddler of following format:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">GET http://127.0.0.1:8181/recipes/default/tiddlers/chashell
Accept: application/json; charset=utf-8
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="hl"><span class="lnt">13
</span></span><span class="hl"><span class="lnt">14
</span></span><span class="hl"><span class="lnt">15
</span></span><span class="lnt">16
</span><span class="hl"><span class="lnt">17
</span></span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="n">Date</span><span class="o">:</span> <span class="l">Wed, 13 Jul 2022 12:49:58 GMT</span>
<span class="n">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<span class="n">Keep-Alive</span><span class="o">:</span> <span class="l">timeout=5</span>
<span class="n">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

<span class="p">{</span>
  <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;chashell&#34;</span><span class="p">,</span>
  <span class="nt">&#34;created&#34;</span><span class="p">:</span> <span class="s2">&#34;20210519103441485&#34;</span><span class="p">,</span>
  <span class="nt">&#34;modified&#34;</span><span class="p">:</span> <span class="s2">&#34;20210519103528982&#34;</span><span class="p">,</span>
  <span class="nt">&#34;fields&#34;</span><span class="p">:</span> <span class="p">{</span>
<span class="hl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;chashell&#34;</span><span class="p">,</span>
</span><span class="hl">    <span class="nt">&#34;note&#34;</span><span class="p">:</span> <span class="s2">&#34;Chashell is a Go reverse shell that communicates over DNS. It can be used to bypass firewalls or tightly restricted networks.&#34;</span><span class="p">,</span>
</span><span class="hl">    <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://github.com/sysdream/chashell&#34;</span>
</span>  <span class="p">},</span>
<span class="hl">  <span class="nt">&#34;tags&#34;</span><span class="p">:</span> <span class="s2">&#34;Golang Security Tool Bookmark&#34;</span><span class="p">,</span>
</span>  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;text/vnd.tiddlywiki&#34;</span><span class="p">,</span>
  <span class="nt">&#34;revision&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&#34;bag&#34;</span><span class="p">:</span> <span class="s2">&#34;default&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Every bookmarks consists of a <strong>name</strong>, a <strong>note</strong> and an <strong>url</strong>. Every tiddler supposed to be a bookmark is tagged by <code>Bookmark</code>. In this <code>chashell</code> is
a tiddler and at the same time a bookmark in my wiki.
<span class="sidenote-number"><small class="sidenote">
This is the entry in my public Tiddlywiki instance: <a href="https://brainfck.org/#chashell">https://brainfck.org/#chashell</a>.
</small></span>
As part of my daily routine, I go through my <a href="https://blog.dornea.nu/2021/09/01/inbox-zero-using-getpocket/">pocket entries</a> and decide which ones I should bookmark in Tiddlywiki. These are my keybindings
for the getpocket major mode:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="hl"><span class="lnt">12
</span></span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">map!</span> <span class="nb">:map</span> <span class="nv">pocket-reader-mode-map</span>
      <span class="nb">:after</span> <span class="nv">pocket-reader</span>
      <span class="nb">:nm</span> <span class="s">&#34;d&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-delete</span>
      <span class="nb">:nm</span> <span class="s">&#34;SD&#34;</span> <span class="nf">#&#39;</span><span class="nv">dorneanu/pocket-reader-send-to-dropbox</span>
      <span class="nb">:nm</span> <span class="s">&#34;a&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-toggle-archived</span>
      <span class="nb">:nm</span> <span class="s">&#34;B&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-open-in-external-browser</span>
      <span class="nb">:nm</span> <span class="s">&#34;e&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-excerpt</span>
      <span class="nb">:nm</span> <span class="s">&#34;G&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-more</span>
      <span class="nb">:nm</span> <span class="s">&#34;TAB&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-open-url</span>
      <span class="nb">:nm</span> <span class="s">&#34;tr&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-remove-tags</span>
      <span class="nb">:nm</span> <span class="s">&#34;tN&#34;</span> <span class="nf">#&#39;</span><span class="nv">dorneanu/pocket-reader-remove-next</span>
<span class="hl">      <span class="nb">:nm</span> <span class="s">&#34;C-b&#34;</span> <span class="nf">#&#39;</span><span class="nv">dorneanu/tiddlywiki-add-bookmark</span>
</span>      <span class="nb">:nm</span> <span class="s">&#34;ta&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-add-tags</span>
      <span class="nb">:nm</span> <span class="s">&#34;gr&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-refresh</span>
      <span class="nb">:nm</span> <span class="s">&#34;p&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-search</span>
      <span class="nb">:nm</span> <span class="s">&#34;U&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-unmark-all</span>
      <span class="nb">:nm</span> <span class="s">&#34;y&#34;</span> <span class="nf">#&#39;</span><span class="nv">pocket-reader-copy-url</span>
      <span class="nb">:nm</span> <span class="s">&#34;Y&#34;</span> <span class="nf">#&#39;</span><span class="nv">dorneanu/pocket-reader-copy-to-scratch</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s have a look at <code>dorneanu/tiddlywiki-add-bookmark</code>:
<span class="sidenote-number"><small class="sidenote">
Again: You can find all my customized functions in my <a href="https://github.com/dorneanu/dotfiles/blob/master/dot_doom.d/config.org#tiddlywiki">dotfiles</a>.
</small></span>
<a id="code-snippet--function-tiddlywiki-add-bookmark-getpocket"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">dorneanu/tiddlywiki-add-bookmark</span> <span class="p">()</span>
  <span class="s">&#34;Adds a new bookmark to tiddlywiki. The URL is fetched from clipboard or killring&#34;</span>
    <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;url-util</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">pocket-reader-copy-url</span><span class="p">)</span>

    <span class="p">(</span><span class="nb">setq</span> <span class="nv">my-url</span> <span class="p">(</span><span class="nv">org-web-tools--get-first-url</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">url-html</span> <span class="p">(</span><span class="nv">org-web-tools--get-url</span> <span class="nv">my-url</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">url-title</span> <span class="p">(</span><span class="nv">org-web-tools--html-title</span> <span class="nv">url-html</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">url-title-mod</span> <span class="p">(</span><span class="nf">read-string</span> <span class="s">&#34;Title: &#34;</span> <span class="nv">url-title</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">url-path</span> <span class="p">(</span><span class="nv">url-hexify-string</span> <span class="nv">url-title-mod</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">url-note</span> <span class="p">(</span><span class="nf">read-string</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;Note for &#34;</span> <span class="nv">my-url</span> <span class="s">&#34;:&#34;</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">url-tags</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;Bookmark &#34;</span><span class="p">(</span><span class="nf">read-string</span> <span class="s">&#34;Additional tags: &#34;</span><span class="p">)))</span>

    <span class="p">(</span><span class="nv">request</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">tiddlywiki-base-path</span> <span class="nv">url-path</span><span class="p">)</span>
    <span class="nb">:type</span> <span class="s">&#34;PUT&#34;</span>
    <span class="nb">:data</span> <span class="p">(</span><span class="nv">json-encode</span> <span class="o">`</span><span class="p">((</span><span class="s">&#34;name&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">url-title-mod</span><span class="p">)</span> <span class="p">(</span><span class="s">&#34;note&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">url-note</span><span class="p">)</span> <span class="p">(</span><span class="s">&#34;url&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">my-url</span><span class="p">)</span> <span class="p">(</span><span class="s">&#34;tags&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">url-tags</span><span class="p">)))</span>
    <span class="nb">:headers</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;Content-Type&#34;</span> <span class="o">.</span> <span class="s">&#34;application/json&#34;</span><span class="p">)</span> <span class="p">(</span><span class="s">&#34;X-Requested-With&#34;</span> <span class="o">.</span> <span class="s">&#34;TiddlyWiki&#34;</span><span class="p">)</span> <span class="p">(</span><span class="s">&#34;Accept&#34;</span> <span class="o">.</span> <span class="s">&#34;application/json&#34;</span><span class="p">))</span>
    <span class="nb">:parser</span> <span class="ss">&#39;json-read</span>
    <span class="nb">:success</span>
    <span class="p">(</span><span class="nb">cl-function</span>
            <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;key</span> <span class="nv">data</span> <span class="kp">&amp;allow-other-keys</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;I sent: %S&#34;</span> <span class="p">(</span><span class="nv">assoc-default</span> <span class="ss">&#39;args</span> <span class="nv">data</span><span class="p">))))</span>
    <span class="nb">:complete</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Added %s&#34;</span> <span class="p">(</span><span class="nf">symbol-value</span> <span class="ss">&#39;url-title-mod</span><span class="p">)))</span>
    <span class="nb">:error</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Some error&#34;</span><span class="p">))</span>
    <span class="nb">:status-code</span> <span class="o">&#39;</span><span class="p">((</span><span class="mi">400</span> <span class="o">.</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Got 400.&#34;</span><span class="p">)))</span>
                    <span class="p">(</span><span class="mi">418</span> <span class="o">.</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Got 418.&#34;</span><span class="p">)))</span>
                    <span class="p">(</span><span class="mi">204</span> <span class="o">.</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Got 202.&#34;</span><span class="p">))))</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--function-tiddlywiki-add-bookmark-getpocket">Code Snippet 18</a>:</span>
  Bookmark entries from getpocket directly into Tiddlywiki
</div>
<h3 id="add-quote">Add quote</h3>
<p>After reading each book I usually do some post-reading/post-processing. While I could use the
Tiddlywiki web interface to add new tiddlers, I&rsquo;d rather do it from Emacs directly.</p>
<p>Often I need to insert new quotes from book (or web articles). How to I do this:</p>
<p><a id="code-snippet--function-tiddlywiki-add-quote"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">dorneanu/tiddlywiki-add-quote</span> <span class="p">()</span>
  <span class="s">&#34;Adds a new quote&#34;</span>
    <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>

    <span class="p">(</span><span class="nb">setq</span> <span class="nv">quote-title</span> <span class="p">(</span><span class="nf">read-string</span> <span class="s">&#34;Quote title: &#34;</span> <span class="nv">quote-title</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">url-path</span> <span class="p">(</span><span class="nv">url-hexify-string</span> <span class="nv">quote-title</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">quote-source</span> <span class="p">(</span><span class="nf">read-string</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;Source for &#34;</span> <span class="nv">quote-title</span> <span class="s">&#34;: &#34;</span><span class="p">)</span> <span class="nv">quote-source</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">quote-body</span> <span class="p">(</span><span class="nf">read-string</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;Text for &#34;</span> <span class="nv">quote-title</span> <span class="s">&#34;: &#34;</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">quote-tags</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;quote &#34;</span><span class="p">(</span><span class="nf">read-string</span> <span class="s">&#34;Additional tags: &#34;</span><span class="p">)))</span>

    <span class="p">(</span><span class="nv">request</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">tiddlywiki-base-path</span> <span class="nv">url-path</span><span class="p">)</span>
    <span class="nb">:type</span> <span class="s">&#34;PUT&#34;</span>
    <span class="nb">:data</span> <span class="p">(</span><span class="nv">json-encode</span> <span class="o">`</span><span class="p">(</span>
        <span class="p">(</span><span class="s">&#34;title&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">quote-title</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;created&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nf">format-time-string</span> <span class="s">&#34;%Y%m%d%H%M%S%3N&#34;</span><span class="p">))</span>
        <span class="p">(</span><span class="s">&#34;modified&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nf">format-time-string</span> <span class="s">&#34;%Y%m%d%H%M%S%3N&#34;</span><span class="p">))</span>
        <span class="p">(</span><span class="s">&#34;source&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">quote-source</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;tags&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">quote-tags</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;text&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="nv">quote-body</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;type&#34;</span> <span class="o">.</span> <span class="s">&#34;text/vnd.tiddlywiki&#34;</span><span class="p">)))</span>
    <span class="nb">:headers</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;Content-Type&#34;</span> <span class="o">.</span> <span class="s">&#34;application/json&#34;</span><span class="p">)</span> <span class="p">(</span><span class="s">&#34;X-Requested-With&#34;</span> <span class="o">.</span> <span class="s">&#34;TiddlyWiki&#34;</span><span class="p">)</span> <span class="p">(</span><span class="s">&#34;Accept&#34;</span> <span class="o">.</span> <span class="s">&#34;application/json&#34;</span><span class="p">))</span>
    <span class="nb">:parser</span> <span class="ss">&#39;json-read</span>
    <span class="nb">:success</span>
    <span class="p">(</span><span class="nb">cl-function</span>
            <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;key</span> <span class="nv">data</span> <span class="kp">&amp;allow-other-keys</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;I sent: %S&#34;</span> <span class="p">(</span><span class="nv">assoc-default</span> <span class="ss">&#39;args</span> <span class="nv">data</span><span class="p">))))</span>
    <span class="nb">:complete</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Added quote &lt;%s&gt;&#34;</span> <span class="p">(</span><span class="nf">symbol-value</span> <span class="ss">&#39;quote-title</span><span class="p">)))</span>
    <span class="nb">:error</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Some error&#34;</span><span class="p">))</span>
    <span class="nb">:status-code</span> <span class="o">&#39;</span><span class="p">((</span><span class="mi">400</span> <span class="o">.</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Got 400.&#34;</span><span class="p">)))</span>
                    <span class="p">(</span><span class="mi">418</span> <span class="o">.</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Got 418.&#34;</span><span class="p">)))</span>
                    <span class="p">(</span><span class="mi">204</span> <span class="o">.</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Got 202.&#34;</span><span class="p">))))</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--function-tiddlywiki-add-quote">Code Snippet 19</a>:</span>
  Directly add new quotes from Emacs
</div>
<p>I simply invoke <code>M-x dorneanu/tiddlywiki-add-quote</code> and <code>read-string</code> will ask for a quote title, some source of the quote (e.g. a book)
and of course the actual text.</p>
<h2 id="hydra">Hydra</h2>
<p>I&rsquo;ve recently discovered <a href="https://github.com/abo-abo/hydra">hydra</a> and I came up with some hydra also for TiddlyWiki:</p>
<p><a id="code-snippet--tiddlywiki-customized-hydra"></a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-tiddlywiki</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">blue</span> <span class="nb">:hint</span> <span class="no">nil</span><span class="p">)</span>
<span class="s">&#34;
</span><span class="s">Tiddlywiki commands^
</span><span class="s">---------------------------------------------------------
</span><span class="s">_b_ Add new bookmark
</span><span class="s">_j_ Add new journal entry
</span><span class="s">_t_ Add new tiddler
</span><span class="s">_q_ Add new quote
</span><span class="s">&#34;</span>
  <span class="p">(</span><span class="s">&#34;b&#34;</span> <span class="nv">dorneanu/tiddlywiki-add-bookmark</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;j&#34;</span> <span class="nv">vd/tw5-journal-file-by-date</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="nv">dorneanu/tiddlywiki-add-quote</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="nv">dorneanu/tiddlywiki-add-tiddler</span><span class="p">))</span>

<span class="c1">;; Keybindings</span>
<span class="p">(</span><span class="nv">my-leader-def</span>
  <span class="nb">:infix</span> <span class="s">&#34;m w&#34;</span>
  <span class="s">&#34;h&#34;</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">hydra-tiddlywiki/body</span> <span class="nb">:which-key</span> <span class="s">&#34;Open Tiddlywiki hydra&#34;</span><span class="p">)</span>
  <span class="s">&#34;j&#34;</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">vd/tw5-journal-file-by-date</span> <span class="nb">:which-key</span> <span class="s">&#34;Create/Open TW5 Journal file&#34;</span><span class="p">)</span>
  <span class="s">&#34;s&#34;</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">my/rg-tiddlywiki-directory</span> <span class="nb">:which-key</span> <span class="s">&#34;Search in TW5 directory&#34;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><div class="src-block-caption">
  <span class="src-block-number"><a href="#code-snippet--tiddlywiki-customized-hydra">Code Snippet 20</a>:</span>
  Hydra for Tiddlywiki
</div>
<p>This way I press <code>M m w h</code> and the TiddlyWiki hydra will pop up.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I hope some day there will be a full (elisp) package for TiddlyWiki combining some of the
functionalities/ideas mentioned here. If you have anything to add/share, please let me know.</p>
</div>
  <div id="comments">
      
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "dorneanu" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
</main>
 






<div class="tl fixed list-pages lh-copy" id="contents-list"></div>



<div class="pagination tc tr-l db fixed-l bottom-2-l right-2-l mb3 mb0-l">
  
<a id="scroll-to-top" class="f6 o-0 link br2 ph2 pv1 mb1 bg-main-color pointer" onclick="topFunction()" style="color: #fff; visibility: hidden; display: none; transition: opacity .5s, visibility .5s;" title="back to top">back to top</a>
<br>
  <p class="mb0 mt2">
  <a href="https://blog.dornea.nu/2022/06/29/rss/atom-emacs-and-elfeed/">prev</a>
  
  </p>
</div>

  <footer class="content-width mt0 mt5-l mb4 f6 center ph3 gray tc tl-l">
  <hr class="dn db-l ml0-l gray w3"><br>
  Powered by <a href="https://gohugo.io/" target="_blank" class="link gray dim">Hugo</a>, based on the <a href="https://github.com/lingxz/er" target="_blank" class="link gray dim">Er</a> theme.
  2009-2022 Victor Dorneanu - All rights reserved
  <a href="https://blog.dornea.nu/feed.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
</footer>

  



<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<style>.is-active-link::before { background-color: var(--secondary-color); }</style>




<script type="text/javascript">
var prevScrollpos = window.pageYOffset;
window.onscroll = function() {
  var currentScrollPos = window.pageYOffset;

  
  if (document.getElementById("tag-cloud") !== null) { 
    if (prevScrollpos > currentScrollPos) { 
      document.getElementById("tag-cloud").style.visibility = "visible";
      document.getElementById("tag-cloud").style.opacity = "1";
    } else {
      document.getElementById("tag-cloud").style.visibility = "hidden";
      document.getElementById("tag-cloud").style.opacity = "0";
    }
  }
  

  
  if (document.body.scrollTop > 1000 || document.documentElement.scrollTop > 1000) {
      document.getElementById("scroll-to-top").style.display = "inline";
      document.getElementById("scroll-to-top").style.visibility = "visible";
      document.getElementById("scroll-to-top").style.opacity = "1";
  } else {
      document.getElementById("scroll-to-top").style.visibility = "hidden";
      document.getElementById("scroll-to-top").style.opacity = "0";
  }
  
  prevScrollpos = currentScrollPos;
}


function topFunction() {
  document.body.scrollTop = 0; 
  document.documentElement.scrollTop = 0; 
}






if (document.getElementById("contents-list") !== null && document.getElementsByClassName("post-content").length !== 0) { 
  tocbot.init({
    
    tocSelector: '#contents-list',
    
    contentSelector: '.post-content',
    
    headingSelector: 'h1, h2, h3',
  });
}


</script>





<script>
 var glightbox = GLightbox({
     selector: '.glightbox'
 });
</script>

  
</body>
</html>
