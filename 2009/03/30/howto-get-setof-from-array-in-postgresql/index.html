<!doctype html>
<html lang="en">
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

  <title>HowTo: Get SETOF from Array in PostgreSQL - blog.dornea.nu</title>
  <meta content='HowTo: Get SETOF from Array in PostgreSQL - blog.dornea.nu' property='title' />
  <meta content='HowTo: Get SETOF from Array in PostgreSQL - blog.dornea.nu' property='og:title' />


<meta property="og:description" content="The use of so called &ldquo;procedural languages&rdquo; in PostgreSQL allows the user to write user-defined functions in other languages than SQL or C. Since every query is sent to the server, the database server has to know how to interpret and handle function statements. As the PostgreSQL documentation describes, the function handler itself is a C language function compiled into a shared object and loaded on demand. All you have to do is to install the language into your database." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.dornea.nu/2009/03/30/howto-get-setof-from-array-in-postgresql/" />


<meta property="article:published_time" content="2009-03-30T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2009-03-30T00:00:00&#43;00:00"/>








<meta name="generator" content="Hugo 0.89.4" />

<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" rel="stylesheet">
<link href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" rel="stylesheet"/>
<style type="text/css">/*https://coolors.co/afd5aa-f0f2ef-a69f98-3d3d3d-8c6057*/
:root {
  --main-color: #8C6056; 
  --secondary-color: #AFD5AA;
  --logo-text-color: #fff;
  --body-text-color: #3d3d3d;
  --heading-text-color: #383838;
  --background-color: #fff;
}</style>
<link href='https://blog.dornea.nu/css/tachyons.min.css' rel="stylesheet">
<link href='https://blog.dornea.nu/css/styles.css' rel="stylesheet">
<link rel="stylesheet" href="https://blog.dornea.nu/css/custom.css">
<link rel="stylesheet" href="https://blog.dornea.nu/css/syntax.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js"></script>


<link rel="icon" 
 
  href='https://blog.dornea.nu/favicon.ico'

type="image/x-icon"/>

<link href='https://blog.dornea.nu/feed.xml' rel="alternate" type="application/atom+xml" title="blog.dornea.nu" />

</head>
<body class="global-font">
  <nav class=" flex-ns justify-between border-box pa3 pl3-l pr2-l mt1 mt0-ns" id="navbar">
  <div class="flex">
    <a class="f4 fw6 ttu no-underline dim bg-main-color pv1 ph2 br2" id="site-title" href='https://blog.dornea.nu/' title="Home">blog.dornea.nu</a>
  </div>
  
  <div class=" flex-ns mt2 mt0-ns pv1">
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/' title="Home">Home</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='http://dornea.nu' title="About">About</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/feed.xml' title="RSS">RSS</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://blog.dornea.nu/tags' title="Tags">Tags</a>
    
      <a class="link dim dark-gray f6 dib mr2 mr3-l ttu tracked" href='https://brainfck.org' title="Zettelkasten">Zettelkasten</a>
    
  </div>
  
</nav>
  
<main class="center mv4 content-width ph3">
  <div class="f3 fw6 heading-color heading-font post-title">HowTo: Get SETOF from Array in PostgreSQL</div>
  <p class="silver f6 mt1 mb4 post-meta">
    <time>30 Mar 2009</time> 
     | 
    

    
     ~
  

4 mins
|

    
    tags: [ <a href='https://blog.dornea.nu/tags/coding' class="link silver">coding</a> <a href='https://blog.dornea.nu/tags/howto' class="link silver">howto</a> <a href='https://blog.dornea.nu/tags/sql' class="link silver">sql</a> <a href='https://blog.dornea.nu/tags/admin' class="link silver">admin</a> <a href='https://blog.dornea.nu/tags/postgresql' class="link silver">postgresql</a>  ]
    

  </p>
  <div class="lh-copy post-content"><p>The use of so called &ldquo;procedural languages&rdquo; in PostgreSQL allows the user to write user-defined functions in other languages than SQL or C. Since every query is sent to the server, the database server has to know how to interpret and handle function statements. As the PostgreSQL documentation describes, the function handler itself is a C language function compiled into a shared object and loaded on demand. All you have to do is to install the <em>language</em> into your database. Besides that you&rsquo;ll have to install the pre-compiled shared objects on your system. On my system (Debian 5.0) I had to install the <code>postgresql-plperl</code> package. Afterwars I connected to the database and typed:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.sql" data-lang=".sql"><span class="k">CREATE</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="nf">plpgsql_call_handler</span><span class="w"> </span><span class="p">()</span><span class="w">
</span><span class="w">   </span><span class="n">RETURNS</span><span class="w"> </span><span class="n">OPAQUE</span><span class="w">
</span><span class="w">   </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;/usr/lib/postgresql/8.3/lib/plpgsql.so&#39;</span><span class="w">
</span><span class="w"></span><span class="n">LANGUAGE</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Of course you&rsquo;ll have to look up for the right file path in order to work. Finally I was able to use the language <code>plpgsql</code> in my functions. If you need help installing languages just check out the PostgreSQL <a href="http://www.postgresql.org/docs/8.3/static/plpgsql.html">documentation</a> (it helped me too).</p>
<h2 id="polymorphic-types">Polymorphic types</h2>
<p>When speaking of polymorphism in PostgreSQL, we actually refer to the polymorphic functions. So whatâ€™s the difference between a polymorphic type and a polymorphic function? They&rsquo;re related to each other. In fact every function declared to use polymorphic types is called as a polymorphic function. These types (pseudo-types) are <code>anyelement</code> and <code>anyarray</code>. So when arguments of these types are passed to a function, it can handle with different data types. Imagine a function called <code>equal</code> that compares two arguments and returns a boolean:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.sql" data-lang=".sql"><span class="k">CREATE</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="nf">equal</span><span class="w"> </span><span class="p">(</span><span class="n">anyelement</span><span class="p">,</span><span class="n">anyelement</span><span class="p">)</span><span class="w">
</span><span class="w">  </span><span class="n">RETURNS</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="w">      </span><span class="p">...</span><span class="w">
</span><span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="err">$</span><span class="mi">2</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="no">TRUE</span><span class="p">;</span><span class="w">
</span><span class="w">      </span><span class="k">ELSE</span><span class="w">
</span><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="no">FALSE</span><span class="p">;</span><span class="w">
</span><span class="w">      </span><span class="n">END</span><span class="w"> </span><span class="k">IF</span><span class="p">;</span><span class="w">
</span><span class="w">  </span><span class="err">$$</span><span class="w">
</span><span class="w"></span><span class="n">LANGUAGE</span><span class="w"> </span><span class="s1">&#39;sql&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><code>equal</code> will take 2 input values of the SAME data type. Otherwise how could you e.g. compare a string to an integer? Read <a href="http://www.postgresql.org/docs/current/static/extend-type-system.html">more</a>.</p>
<h2 id="getting-started">Getting started</h2>
<p>I&rsquo;ll use following employees table:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.sql" data-lang=".sql"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="nf">t_employee</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="w">
</span><span class="w">        </span><span class="n">ID</span><span class="w"> </span><span class="kt">integer</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="kt">text</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">salary</span><span class="w"> </span><span class="kt">real</span><span class="p">,</span><span class="w"> 
</span><span class="w">        </span><span class="n">start_date</span><span class="w"> </span><span class="kt">date</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">city</span><span class="w"> </span><span class="kt">text</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">primkey_ID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">ID</span><span class="p">)</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">OIDS</span><span class="o">=</span><span class="no">FALSE</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Then we insert some new data into the table:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.sql" data-lang=".sql"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nf">t_employee</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">salary</span><span class="p">,</span><span class="n">start_date</span><span class="p">,</span><span class="n">city</span><span class="p">)</span><span class="w"> 
</span><span class="w">   </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Peter&#39;</span><span class="p">,</span><span class="s1">&#39;2100&#39;</span><span class="p">,</span><span class="s1">&#39;2003-06-19&#39;</span><span class="p">,</span><span class="s1">&#39;Stuttgart&#39;</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nf">t_employee</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">salary</span><span class="p">,</span><span class="n">start_date</span><span class="p">,</span><span class="n">city</span><span class="p">)</span><span class="w"> 
</span><span class="w">   </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Peter&#39;</span><span class="p">,</span><span class="s1">&#39;2100&#39;</span><span class="p">,</span><span class="s1">&#39;2003-06-19&#39;</span><span class="p">,</span><span class="s1">&#39;Stuttgart&#39;</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nf">t_employee</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">salary</span><span class="p">,</span><span class="n">start_date</span><span class="p">,</span><span class="n">city</span><span class="p">)</span><span class="w"> 
</span><span class="w">   </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;Marc&#39;</span><span class="p">,</span><span class="s1">&#39;1560&#39;</span><span class="p">,</span><span class="s1">&#39;2001-02-25&#39;</span><span class="p">,</span><span class="s1">&#39;Mannheim&#39;</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nf">t_employee</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">salary</span><span class="p">,</span><span class="n">start_date</span><span class="p">,</span><span class="n">city</span><span class="p">)</span><span class="w"> 
</span><span class="w">   </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;Stefan&#39;</span><span class="p">,</span><span class="s1">&#39;1100&#39;</span><span class="p">,</span><span class="s1">&#39;2008-03-14&#39;</span><span class="p">,</span><span class="s1">&#39;Hamburg&#39;</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nf">t_employee</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">salary</span><span class="p">,</span><span class="n">start_date</span><span class="p">,</span><span class="n">city</span><span class="p">)</span><span class="w"> 
</span><span class="w">   </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;Gerd&#39;</span><span class="p">,</span><span class="s1">&#39;900&#39;</span><span class="p">,</span><span class="s1">&#39;2004-06-24&#39;</span><span class="p">,</span><span class="s1">&#39;Hannover&#39;</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><code>t_employee</code> will now contain:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.sql" data-lang=".sql"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_employee</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">start_date</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="n">city</span><span class="w">    
</span><span class="w"></span><span class="o">----+--------+--------+------------+---------</span><span class="c1">--
</span><span class="c1">  1 | John   |   1100 | 2002-05-01 | Berlin
</span><span class="c1"></span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Peter</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="mi">2100</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2003</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">19</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Stuttgart</span><span class="w">
</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Marc</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">1560</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Mannheim</span><span class="w">
</span><span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Stefan</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1100</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2008</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">14</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Hamburg</span><span class="w">
</span><span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Gerd</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="mi">900</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2004</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">24</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">Hannover</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="n">rows</span><span class="p">)</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>In the next step we&rsquo;ll try to write a function which returns a SETOF containing our data.</p>
<h2 id="setof-vs-array">SETOF vs. Array</h2>
<p>Now we need a function which returns our data as a SETOF. In my function I can declare <code>l_row</code> of type <code>t_employee</code>(see below). In this variable data is structured as in the table <code>t_employee</code>. So far, no big deal. Just let us have a look at the function:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.sql" data-lang=".sql"><span class="k">CREATE</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="nf">get_employee</span><span class="p">()</span><span class="w">
</span><span class="w">   </span><span class="n">RETURNS</span><span class="w"> </span><span class="n">SETOF</span><span class="w"> </span><span class="n">t_employees</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span><span class="w"></span><span class="err">$</span><span class="n">BODY</span><span class="err">$</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">DECLARE</span><span class="w">
</span><span class="w">   </span><span class="n">l_row</span><span class="w"> </span><span class="n">t_employee</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">
</span><span class="w">   </span><span class="c1">-- Loop through rows
</span><span class="c1"></span><span class="w">   </span><span class="k">FOR</span><span class="w"> </span><span class="n">l_row</span><span class="w"> </span><span class="k">IN</span><span class="w">
</span><span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t_employee</span><span class="w">
</span><span class="w">   </span><span class="k">LOOP</span><span class="w">
</span><span class="w">      </span><span class="c1">-- Return data
</span><span class="c1"></span><span class="w">      </span><span class="k">RETURN</span><span class="w"> </span><span class="n">NEXT</span><span class="w"> </span><span class="n">l_row</span><span class="p">;</span><span class="w">
</span><span class="w">   </span><span class="n">END</span><span class="w"> </span><span class="k">LOOP</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="err">$</span><span class="n">BODY</span><span class="err">$</span><span class="w">
</span><span class="w">   </span><span class="n">LANGUAGE</span><span class="w"> </span><span class="s1">&#39;plpgsql&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Okay. But as you might have noticed, the purpose of this howto ist to show you how to get a SETOF from an array. Therefor we need some array. We&rsquo;ll modify <code>get_employees</code> in this way:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.sql" data-lang=".sql"><span class="k">CREATE</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="nf">get_employee</span><span class="p">()</span><span class="w">
</span><span class="w">   </span><span class="n">RETURNS</span><span class="w"> </span><span class="n">SETOF</span><span class="w"> </span><span class="n">t_employee</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span><span class="w"></span><span class="err">$</span><span class="n">BODY</span><span class="err">$</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">DECLARE</span><span class="w">
</span><span class="w">   </span><span class="n">l_row</span><span class="w"> </span><span class="n">t_employee</span><span class="p">;</span><span class="w">
</span><span class="w">   </span><span class="n">l_array</span><span class="w"> </span><span class="n">t_employee</span><span class="p">[];</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">
</span><span class="w">   </span><span class="c1">-- Loop throught rows
</span><span class="c1"></span><span class="w">   </span><span class="k">FOR</span><span class="w"> </span><span class="n">l_row</span><span class="w"> </span><span class="k">IN</span><span class="w">
</span><span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t_employee</span><span class="w">
</span><span class="w">   </span><span class="k">LOOP</span><span class="w">
</span><span class="w">      </span><span class="c1">-- Put all data into array
</span><span class="c1"></span><span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">array_append</span><span class="p">(</span><span class="n">l_array</span><span class="p">,</span><span class="n">l_row</span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">l_array</span><span class="p">;</span><span class="w">
</span><span class="w">   </span><span class="n">END</span><span class="w"> </span><span class="k">LOOP</span><span class="p">;</span><span class="w">
</span><span class="w">   </span><span class="p">...</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="err">$</span><span class="n">BODY</span><span class="err">$</span><span class="w">
</span><span class="w">   </span><span class="n">LANGUAGE</span><span class="w"> </span><span class="s1">&#39;plpgsql&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>IN the next step we&rsquo;ll have to extract SETOF data from the array. Since you can&rsquo;t do that with built-in Postgres functions, we&rsquo;ll need some auxiliary function:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.sql" data-lang=".sql"><span class="cm">/*
</span><span class="cm">   Polymorphic function &#39;unnest&#39;: ANYARRAY -&amp;gt; SETOF
</span><span class="cm">   Return SETOF from ANYARRAY
</span><span class="cm">*/</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="nf">unnest</span><span class="p">(</span><span class="n">ANYARRAY</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">RETURNS</span><span class="w"> </span><span class="n">SETOF</span><span class="w"> </span><span class="n">ANYELEMENT</span><span class="w">
</span><span class="w"></span><span class="n">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="err">$$</span><span class="w">
</span><span class="w">   </span><span class="k">SELECT</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nf">generate_series</span><span class="p">(</span><span class="nf">array_lower</span><span class="p">(</span><span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nf">array_upper</span><span class="p">(</span><span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="err">$$</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>I hope you have noticed the <code>anyarray</code> which is given as a parameter to the function. So you can use <code>unnest</code> for every type of array. That&rsquo;s the great point when using polymorphic functions: You have some kind of generic function and you can use it for all arrays. Well having this function implemented, we can now modify <code>get_employees</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.sql" data-lang=".sql"><span class="k">CREATE</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="nf">get_employee</span><span class="p">()</span><span class="w">
</span><span class="w">   </span><span class="n">RETURNS</span><span class="w"> </span><span class="n">SETOF</span><span class="w"> </span><span class="n">t_employee</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span><span class="w"></span><span class="err">$</span><span class="n">BODY</span><span class="err">$</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">DECLARE</span><span class="w">
</span><span class="w">   </span><span class="n">l_row</span><span class="w"> </span><span class="n">t_employee</span><span class="p">;</span><span class="w">
</span><span class="w">   </span><span class="n">l_array</span><span class="w"> </span><span class="n">t_employee</span><span class="p">[];</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">
</span><span class="w">   </span><span class="c1">-- Loop throught rows
</span><span class="c1"></span><span class="w">   </span><span class="k">FOR</span><span class="w"> </span><span class="n">l_row</span><span class="w"> </span><span class="k">IN</span><span class="w">
</span><span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t_employee</span><span class="w">
</span><span class="w">   </span><span class="k">LOOP</span><span class="w">
</span><span class="w">      </span><span class="c1">-- Put all data into array
</span><span class="c1"></span><span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">array_append</span><span class="p">(</span><span class="n">l_array</span><span class="p">,</span><span class="n">l_row</span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">l_array</span><span class="p">;</span><span class="w">
</span><span class="w">   </span><span class="n">END</span><span class="w"> </span><span class="k">LOOP</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">   </span><span class="c1">-- ARRAY -&amp;gt; SETOF
</span><span class="c1"></span><span class="w">   </span><span class="k">FOR</span><span class="w"> </span><span class="n">l_row</span><span class="w"> </span><span class="k">IN</span><span class="w">
</span><span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nf">unnest</span><span class="p">(</span><span class="n">l_array</span><span class="p">)</span><span class="w">
</span><span class="w">   </span><span class="k">LOOP</span><span class="w">
</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="n">l_row</span><span class="p">;</span><span class="w">
</span><span class="w">   </span><span class="n">END</span><span class="w"> </span><span class="k">LOOP</span><span class="p">;</span><span class="w"> 
</span><span class="w"></span><span class="n">END</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="err">$</span><span class="n">BODY</span><span class="err">$</span><span class="w">
</span><span class="w">   </span><span class="n">LANGUAGE</span><span class="w"> </span><span class="s1">&#39;plpgsql&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div></div>
  <div id="comments">
      
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "dorneanu" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
</main>
 






<div class="tl fixed list-pages lh-copy" id="contents-list"></div>



<div class="pagination tc tr-l db fixed-l bottom-2-l right-2-l mb3 mb0-l">
  
<a id="scroll-to-top" class="f6 o-0 link br2 ph2 pv1 mb1 bg-main-color pointer" onclick="topFunction()" style="color: #fff; visibility: hidden; display: none; transition: opacity .5s, visibility .5s;" title="back to top">back to top</a>
<br>
  <p class="mb0 mt2">
  <a href="https://blog.dornea.nu/2009/03/18/bye-bye-immobilo/">prev</a>
  <a href="https://blog.dornea.nu/2009/04/07/why-use-python-the-n00b-mini-review/">next</a>
  </p>
</div>

  <footer class="content-width mt0 mt5-l mb4 f6 center ph3 gray tc tl-l">
  <hr class="dn db-l ml0-l gray w3"><br>
  Powered by <a href="https://gohugo.io/" target="_blank" class="link gray dim">Hugo</a>, based on the <a href="https://github.com/lingxz/er" target="_blank" class="link gray dim">Er</a> theme.
  2009-2022 Victor Dorneanu - All rights reserved
  <a href="https://blog.dornea.nu/feed.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
</footer>

  



<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<style>.is-active-link::before { background-color: var(--secondary-color); }</style>




<script type="text/javascript">
var prevScrollpos = window.pageYOffset;
window.onscroll = function() {
  var currentScrollPos = window.pageYOffset;

  
  if (document.getElementById("tag-cloud") !== null) { 
    if (prevScrollpos > currentScrollPos) { 
      document.getElementById("tag-cloud").style.visibility = "visible";
      document.getElementById("tag-cloud").style.opacity = "1";
    } else {
      document.getElementById("tag-cloud").style.visibility = "hidden";
      document.getElementById("tag-cloud").style.opacity = "0";
    }
  }
  

  
  if (document.body.scrollTop > 1000 || document.documentElement.scrollTop > 1000) {
      document.getElementById("scroll-to-top").style.display = "inline";
      document.getElementById("scroll-to-top").style.visibility = "visible";
      document.getElementById("scroll-to-top").style.opacity = "1";
  } else {
      document.getElementById("scroll-to-top").style.visibility = "hidden";
      document.getElementById("scroll-to-top").style.opacity = "0";
  }
  
  prevScrollpos = currentScrollPos;
}


function topFunction() {
  document.body.scrollTop = 0; 
  document.documentElement.scrollTop = 0; 
}






if (document.getElementById("contents-list") !== null && document.getElementsByClassName("post-content").length !== 0) { 
  tocbot.init({
    
    tocSelector: '#contents-list',
    
    contentSelector: '.post-content',
    
    headingSelector: 'h1, h2, h3',
  });
}


</script>





<script>
 var glightbox = GLightbox({
     selector: '.glightbox'
 });
</script>

  
</body>
</html>
